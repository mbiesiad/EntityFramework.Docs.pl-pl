---
title: Migracje Code First w środowiskach zespołów — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 4c2d9a95-de6f-4e97-9738-c1f8043eff69
ms.openlocfilehash: 7ab66a8ec29b60bb2e0102fbca5745d352b07325
ms.sourcegitcommit: ebfd3382fc583bc90f0da58e63d6e3382b30aa22
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/25/2020
ms.locfileid: "85370412"
---
# <a name="code-first-migrations-in-team-environments"></a><span data-ttu-id="6ca69-102">Migracje Code First w środowiskach zespołu</span><span class="sxs-lookup"><span data-stu-id="6ca69-102">Code First Migrations in Team Environments</span></span>
> [!NOTE]
> <span data-ttu-id="6ca69-103">W tym artykule założono, że wiesz, jak używać Migracje Code First w podstawowych scenariuszach.</span><span class="sxs-lookup"><span data-stu-id="6ca69-103">This article assumes you know how to use Code First Migrations in basic scenarios.</span></span> <span data-ttu-id="6ca69-104">Jeśli tego nie zrobisz, musisz przeczytać [migracje Code First](~/ef6/modeling/code-first/migrations/index.md) przed kontynuowaniem.</span><span class="sxs-lookup"><span data-stu-id="6ca69-104">If you don’t, then you’ll need to read [Code First Migrations](~/ef6/modeling/code-first/migrations/index.md) before continuing.</span></span>

## <a name="grab-a-coffee-you-need-to-read-this-whole-article"></a><span data-ttu-id="6ca69-105">Weź pod nich kawę, musisz przeczytać ten cały artykuł</span><span class="sxs-lookup"><span data-stu-id="6ca69-105">Grab a coffee, you need to read this whole article</span></span>

<span data-ttu-id="6ca69-106">Problemy w środowiskach zespołu polegają głównie na scalaniu migracji, gdy dwaj deweloperzy wygenerowały migracje w lokalnej bazie kodu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-106">The issues in team environments are mostly around merging migrations when two developers have generated migrations in their local code base.</span></span> <span data-ttu-id="6ca69-107">Chociaż kroki, które należy rozwiązać, są bardzo proste, wymagają one pełnego poznania sposobu działania migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-107">While the steps to solve these are pretty simple, they require you to have a solid understanding of how migrations works.</span></span> <span data-ttu-id="6ca69-108">Nie przeskoczę do końca — Poświęć chwilę na zapoznanie się z całym artykułem, aby upewnić się, że powiodło się.</span><span class="sxs-lookup"><span data-stu-id="6ca69-108">Please don’t just skip ahead to the end – take the time to read the whole article to ensure you are successful.</span></span>

## <a name="some-general-guidelines"></a><span data-ttu-id="6ca69-109">Niektóre ogólne wytyczne</span><span class="sxs-lookup"><span data-stu-id="6ca69-109">Some general guidelines</span></span>

<span data-ttu-id="6ca69-110">Zanim Dig się na zarządzanie scalanymi migracjami wygenerowanymi przez wielu deweloperów, poniżej przedstawiono niektóre ogólne wskazówki dotyczące konfigurowania sukcesu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-110">Before we dig into how to manage merging migrations generated by multiple developers, here are some general guidelines to set you up for success.</span></span>

### <a name="each-team-member-should-have-a-local-development-database"></a><span data-ttu-id="6ca69-111">Każdy członek zespołu powinien mieć lokalną bazę danych programistycznych</span><span class="sxs-lookup"><span data-stu-id="6ca69-111">Each team member should have a local development database</span></span>

<span data-ttu-id="6ca69-112">Migracja korzysta z tabeli \*\* \_ \_ MigrationsHistory\*\* do przechowywania migracji, które zostały zastosowane do bazy danych programu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-112">Migrations uses the **\_\_MigrationsHistory** table to store what migrations have been applied to the database.</span></span> <span data-ttu-id="6ca69-113">Jeśli masz wielu deweloperów generujących różne migracje przy próbie docelowej tej samej bazy danych (i w ten sposób udostępnianie tabeli \*\* \_ \_ MigrationsHistory\*\* ), migracje są bardzo mylone.</span><span class="sxs-lookup"><span data-stu-id="6ca69-113">If you have multiple developers generating different migrations while trying to target the same database (and thus share a **\_\_MigrationsHistory** table) migrations is going to get very confused.</span></span>

<span data-ttu-id="6ca69-114">Oczywiście, jeśli masz członków zespołu, którzy nie generują migracji, nie ma żadnego problemu, aby udostępnić centralną bazę danych programistycznych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-114">Of course, if you have team members that aren’t generating migrations, there is no problem having them share a central development database.</span></span>

### <a name="avoid-automatic-migrations"></a><span data-ttu-id="6ca69-115">Unikaj automatycznych migracji</span><span class="sxs-lookup"><span data-stu-id="6ca69-115">Avoid automatic migrations</span></span>

<span data-ttu-id="6ca69-116">Dolna linia polega na pierwszym wyszukiwaniu automatycznych migracji w środowiskach zespołu, ale w rzeczywistości nie działają.</span><span class="sxs-lookup"><span data-stu-id="6ca69-116">The bottom line is that automatic migrations initially look good in team environments, but in reality they just don’t work.</span></span> <span data-ttu-id="6ca69-117">Jeśli chcesz dowiedzieć się, dlaczego należy czytać — Jeśli nie, możesz przejść do następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-117">If you want to know why, keep reading – if not, then you can skip to the next section.</span></span>

<span data-ttu-id="6ca69-118">Automatyczne migracje umożliwiają zaktualizowanie schematu bazy danych w taki sposób, aby był zgodny z bieżącym modelem bez konieczności generowania plików kodu (migracje oparte na kodzie).</span><span class="sxs-lookup"><span data-stu-id="6ca69-118">Automatic migrations allows you to have your database schema updated to match the current model without the need to generate code files (code-based migrations).</span></span> <span data-ttu-id="6ca69-119">Migracje automatyczne działają bardzo dobrze w środowisku zespołu, jeśli kiedykolwiek były używane, i nigdy nie generują żadnych migracji opartych na kodzie.</span><span class="sxs-lookup"><span data-stu-id="6ca69-119">Automatic migrations would work very well in a team environment if you only ever used them and never generated any code-based migrations.</span></span> <span data-ttu-id="6ca69-120">Problem polega na tym, że automatyczne migracje są ograniczone i nie obsługują wielu operacji — zmiana nazw właściwości/kolumn, przenoszenie danych do innej tabeli itp. Aby obsłużyć te scenariusze, można wykonać generowanie migracji opartych na kodzie (i edytowanie kodu szkieletowego), które są mieszane między zmianami, które są obsługiwane przez migracje automatyczne.</span><span class="sxs-lookup"><span data-stu-id="6ca69-120">The problem is that automatic migrations are limited and don’t handle a number of operations – property/column renames, moving data to another table, etc. To handle these scenarios you end up generating code-based migrations (and editing the scaffolded code) that are mixed in between changes that are handled by automatic migrations.</span></span> <span data-ttu-id="6ca69-121">Dzięki temu nie można scalić zmian, gdy dwaj deweloperzy zaewidencjonują migracje.</span><span class="sxs-lookup"><span data-stu-id="6ca69-121">This makes it near on impossible to merge changes when two developers check in migrations.</span></span>

## <a name="screencasts"></a><span data-ttu-id="6ca69-122">Screencasts</span><span class="sxs-lookup"><span data-stu-id="6ca69-122">Screencasts</span></span>

<span data-ttu-id="6ca69-123">Jeśli wolisz obejrzeć zrzut ekranu przedstawiający niż odczytanie tego artykułu, następujące dwa wideo obejmują tę samą zawartość co ten artykuł.</span><span class="sxs-lookup"><span data-stu-id="6ca69-123">If you'd rather watch a screencast than read this article, the following two videos cover the same content as this article.</span></span>

### <a name="video-one-migrations---under-the-hood"></a><span data-ttu-id="6ca69-124">Wideo one: "migracje — pod okapem"</span><span class="sxs-lookup"><span data-stu-id="6ca69-124">Video One: "Migrations - Under the Hood"</span></span>

<span data-ttu-id="6ca69-125">[Ten zrzut ekranu przedstawiający](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) dotyczy sposobu, w jaki migracja śledzi i używa informacji o modelu do wykrywania zmian modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-125">[This screencast](https://channel9.msdn.com/blogs/ef/migrations-under-the-hood) covers how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="video-two-migrations---team-environments"></a><span data-ttu-id="6ca69-126">Wideo dwa: "migracje-środowiska zespołu"</span><span class="sxs-lookup"><span data-stu-id="6ca69-126">Video Two: "Migrations - Team Environments"</span></span>

<span data-ttu-id="6ca69-127">Na podstawie koncepcji z poprzedniego wideo [Ten zrzut ekranu przedstawiający](https://channel9.msdn.com/blogs/ef/migrations-team-environments) obejmuje problemy, które pojawiają się w środowisku zespołowym i sposoby ich rozwiązywania.</span><span class="sxs-lookup"><span data-stu-id="6ca69-127">Building on the concepts from the previous video, [this screencast](https://channel9.msdn.com/blogs/ef/migrations-team-environments) covers the issues that arise in a team environment and how to solve them.</span></span>

## <a name="understanding-how-migrations-works"></a><span data-ttu-id="6ca69-128">Zrozumienie, jak działa migracja</span><span class="sxs-lookup"><span data-stu-id="6ca69-128">Understanding how migrations works</span></span>

<span data-ttu-id="6ca69-129">Kluczem do pomyślnego użycia migracji w środowisku zespołowym jest podstawowe zrozumienie, jak migracja śledzi i używa informacji o modelu do wykrywania zmian modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-129">The key to successfully using migrations in a team environment is a basic understanding how migrations tracks and uses information about the model to detect model changes.</span></span>

### <a name="the-first-migration"></a><span data-ttu-id="6ca69-130">Pierwsza migracja</span><span class="sxs-lookup"><span data-stu-id="6ca69-130">The first migration</span></span>

<span data-ttu-id="6ca69-131">Po dodaniu pierwszej migracji do projektu, w konsoli Menedżera pakietów jest uruchamiany element, taki jak **Dodaj migrację** .</span><span class="sxs-lookup"><span data-stu-id="6ca69-131">When you add the first migration to your project, you run something like **Add-Migration First** in Package Manager Console.</span></span> <span data-ttu-id="6ca69-132">Poniżej przedstawiono kroki wysokiego poziomu wykonywane przez to polecenie.</span><span class="sxs-lookup"><span data-stu-id="6ca69-132">The high level steps that this command performs are pictured below.</span></span>

![Pierwsza migracja](~/ef6/media/firstmigration.png)

<span data-ttu-id="6ca69-134">Bieżący model jest obliczany na podstawie kodu (1).</span><span class="sxs-lookup"><span data-stu-id="6ca69-134">The current model is calculated from your code (1).</span></span> <span data-ttu-id="6ca69-135">Wymagane obiekty bazy danych są następnie obliczane przez model różnią się (2) — ponieważ jest to pierwsza migracja, model różni się tylko za pomocą pustego modelu do porównania.</span><span class="sxs-lookup"><span data-stu-id="6ca69-135">The required database objects are then calculated by the model differ (2) – since this is the first migration the model differ just uses an empty model for the comparison.</span></span> <span data-ttu-id="6ca69-136">Wymagane zmiany są przesyłane do generatora kodu w celu utworzenia wymaganego kodu migracji (3), który jest następnie dodawany do rozwiązania programu Visual Studio (4).</span><span class="sxs-lookup"><span data-stu-id="6ca69-136">The required changes are passed to the code generator to build the required migration code (3) which is then added to your Visual Studio solution (4).</span></span>

<span data-ttu-id="6ca69-137">Oprócz faktycznego kodu migracji, który jest przechowywany w pliku kodu głównego, migracja również generuje kilka dodatkowych plików powiązanych z kodem.</span><span class="sxs-lookup"><span data-stu-id="6ca69-137">In addition to the actual migration code that is stored in the main code file, migrations also generates some additional code-behind files.</span></span> <span data-ttu-id="6ca69-138">Te pliki są metadanymi, które są używane przez migracje i nie są coś, co należy edytować.</span><span class="sxs-lookup"><span data-stu-id="6ca69-138">These files are metadata that is used by migrations and are not something you should edit.</span></span> <span data-ttu-id="6ca69-139">Jeden z tych plików jest plikiem zasobów (. resx) zawierającym migawkę modelu w momencie wygenerowania migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-139">One of these files is a resource file (.resx) that contains a snapshot of the model at the time the migration was generated.</span></span> <span data-ttu-id="6ca69-140">Zobaczysz, jak to jest używane w następnym kroku.</span><span class="sxs-lookup"><span data-stu-id="6ca69-140">You’ll see how this is used in the next step.</span></span>

<span data-ttu-id="6ca69-141">W tym momencie prawdopodobnie chcesz uruchomić polecenie **Update-Database** , aby zastosować zmiany do bazy danych, a następnie przejdź do implementacji innych obszarów aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-141">At this point you would probably run **Update-Database** to apply your changes to the database, and then go about implementing other areas of your application.</span></span>

### <a name="subsequent-migrations"></a><span data-ttu-id="6ca69-142">Kolejne migracje</span><span class="sxs-lookup"><span data-stu-id="6ca69-142">Subsequent migrations</span></span>

<span data-ttu-id="6ca69-143">Później powrócisz i wprowadzisz pewne zmiany do modelu — w naszym przykładzie dodamy do **blogu**Właściwość **adresu URL** .</span><span class="sxs-lookup"><span data-stu-id="6ca69-143">Later you come back and make some changes to your model – in our example we’ll add a **Url** property to **Blog**.</span></span> <span data-ttu-id="6ca69-144">Następnie można wydać polecenie, takie jak **dodanie AddUrl migracji** , aby przeprowadzić szkielet migracji w celu zastosowania odpowiednich zmian w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-144">You would then issue a command such as **Add-Migration AddUrl** to scaffold a migration to apply the corresponding database changes.</span></span> <span data-ttu-id="6ca69-145">Poniżej przedstawiono kroki wysokiego poziomu wykonywane przez to polecenie.</span><span class="sxs-lookup"><span data-stu-id="6ca69-145">The high level steps that this command performs are pictured below.</span></span>

![Druga migracja](~/ef6/media/secondmigration.png)

<span data-ttu-id="6ca69-147">Podobnie jak w przypadku ostatniego czasu bieżący model jest obliczany na podstawie kodu (1).</span><span class="sxs-lookup"><span data-stu-id="6ca69-147">Just like last time, the current model is calculated from code (1).</span></span> <span data-ttu-id="6ca69-148">Jednak w tej chwili istnieją migracje, dlatego poprzedni model zostanie pobrany z najnowszej migracji (2).</span><span class="sxs-lookup"><span data-stu-id="6ca69-148">However, this time there are existing migrations so the previous model is retrieved from the latest migration (2).</span></span> <span data-ttu-id="6ca69-149">Te dwa modele są różnicowane w celu znalezienia wymaganych zmian w bazie danych (3), a następnie proces kończy się tak jak wcześniej.</span><span class="sxs-lookup"><span data-stu-id="6ca69-149">These two models are diffed to find the required database changes (3) and then the process completes as before.</span></span>

<span data-ttu-id="6ca69-150">Ten sam proces jest używany w przypadku wszelkich dalszych migracji dodawanych do projektu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-150">This same process is used for any further migrations that you add to the project.</span></span>

### <a name="why-bother-with-the-model-snapshot"></a><span data-ttu-id="6ca69-151">Dlaczego bother z migawką modelu?</span><span class="sxs-lookup"><span data-stu-id="6ca69-151">Why bother with the model snapshot?</span></span>

<span data-ttu-id="6ca69-152">Może być zastanawiasz się, dlaczego EF obydwa z migawek modelu — dlaczego nie tylko Przyjrzyj się bazie danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-152">You may be wondering why EF bothers with the model snapshot – why not just look at the database.</span></span> <span data-ttu-id="6ca69-153">Jeśli tak, przeczytaj.</span><span class="sxs-lookup"><span data-stu-id="6ca69-153">If so, read on.</span></span> <span data-ttu-id="6ca69-154">Jeśli nie jesteś zainteresowany, możesz pominąć tę sekcję.</span><span class="sxs-lookup"><span data-stu-id="6ca69-154">If you’re not interested then you can skip this section.</span></span>

<span data-ttu-id="6ca69-155">Istnieje wiele powodów, w których zachowanie migawek modelu jest zachowywane:</span><span class="sxs-lookup"><span data-stu-id="6ca69-155">There are a number of reasons EF keeps the model snapshot around:</span></span>

-   <span data-ttu-id="6ca69-156">Umożliwia ona przedryfowanie bazy danych z modelu EF.</span><span class="sxs-lookup"><span data-stu-id="6ca69-156">It allows your database to drift from the EF model.</span></span> <span data-ttu-id="6ca69-157">Te zmiany można wprowadzać bezpośrednio w bazie danych programu lub można zmienić kod szkieletowy w migracjach, aby wprowadzić zmiany.</span><span class="sxs-lookup"><span data-stu-id="6ca69-157">These changes can be made directly in the database, or you can change the scaffolded code in your migrations to make the changes.</span></span> <span data-ttu-id="6ca69-158">Poniżej przedstawiono kilka przykładów tego zalecenia:</span><span class="sxs-lookup"><span data-stu-id="6ca69-158">Here are a couple of examples of this in practice:</span></span>
    -   <span data-ttu-id="6ca69-159">Chcesz dodać wstawioną i zaktualizowaną kolumnę do co najmniej jednej tabeli, ale nie chcesz uwzględniać tych kolumn w modelu EF.</span><span class="sxs-lookup"><span data-stu-id="6ca69-159">You want to add an Inserted and Updated to column to one or more of your tables but you don’t want to include these columns in the EF model.</span></span> <span data-ttu-id="6ca69-160">Jeśli podczas migracji oglądana jest baza danych, będzie ona stale próbować porzucić te kolumny przy każdym utworzeniu szkieletu migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-160">If migrations looked at the database it would continually try to drop these columns every time you scaffolded a migration.</span></span> <span data-ttu-id="6ca69-161">Przy użyciu migawki modelu EF będzie wykrywać tylko te same zmiany w modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-161">Using the model snapshot, EF will only ever detect legitimate changes to the model.</span></span>
    -   <span data-ttu-id="6ca69-162">Należy zmienić treść procedury składowanej używanej do aktualizacji w celu uwzględnienia niektórych dzienników.</span><span class="sxs-lookup"><span data-stu-id="6ca69-162">You want to change the body of a stored procedure used for updates to include some logging.</span></span> <span data-ttu-id="6ca69-163">Jeśli migracje przeszukiwane w ramach tej procedury składowanej pochodzą z bazy danych, będzie ona stale próbować i resetować ją z powrotem do definicji, która jest oczekiwana przez EF.</span><span class="sxs-lookup"><span data-stu-id="6ca69-163">If migrations looked at this stored procedure from the database it would continually try and reset it back to the definition that EF expects.</span></span> <span data-ttu-id="6ca69-164">Przy użyciu migawki modelu EF tylko kiedykolwiek kod szkieletu, aby zmienić procedurę składowaną w przypadku zmiany kształtu procedury w modelu EF.</span><span class="sxs-lookup"><span data-stu-id="6ca69-164">By using the model snapshot, EF will only ever scaffold code to alter the stored procedure when you change the shape of the procedure in the EF model.</span></span>
    -   <span data-ttu-id="6ca69-165">Te same zasady mają zastosowanie do dodawania dodatkowych indeksów, w tym dodatkowych tabel w bazie danych, mapowanie EF do widoku bazy danych, który znajduje się na tabeli itd.</span><span class="sxs-lookup"><span data-stu-id="6ca69-165">These same principles apply to adding extra indexes, including extra tables in your database, mapping EF to a database view that sits over a table, etc.</span></span>
-   <span data-ttu-id="6ca69-166">Model EF zawiera więcej niż tylko kształt bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-166">The EF model contains more than just the shape of the database.</span></span> <span data-ttu-id="6ca69-167">Cały model umożliwia migrowanie informacji o właściwościach i klasach w modelu oraz sposobie ich mapowania do kolumn i tabel.</span><span class="sxs-lookup"><span data-stu-id="6ca69-167">Having the entire model allows migrations to look at information about the properties and classes in your model and how they map to the columns and tables.</span></span> <span data-ttu-id="6ca69-168">Te informacje umożliwiają bardziej inteligentne migracje w kodzie, który szkieletuje.</span><span class="sxs-lookup"><span data-stu-id="6ca69-168">This information allows migrations to be more intelligent in the code that it scaffolds.</span></span> <span data-ttu-id="6ca69-169">Na przykład jeśli zmienisz nazwę kolumny, którą Właściwość mapuje na migracje, może wykryć zmianę nazwy, sprawdzając, czy jest to taka sama Właściwość — co nie można zrobić, jeśli masz tylko schemat bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-169">For example, if you change the name of the column that a property maps to migrations can detect the rename by seeing that it’s the same property – something that can’t be done if you only have the database schema.</span></span> 

## <a name="what-causes-issues-in-team-environments"></a><span data-ttu-id="6ca69-170">Co powoduje problemy w środowiskach zespołu</span><span class="sxs-lookup"><span data-stu-id="6ca69-170">What causes issues in team environments</span></span>

<span data-ttu-id="6ca69-171">Przepływ pracy objęty poprzednią sekcją działa dobrze, gdy jesteś pojedynczym deweloperem pracującym nad aplikacją.</span><span class="sxs-lookup"><span data-stu-id="6ca69-171">The workflow covered in the previous section works great when you are a single developer working on an application.</span></span> <span data-ttu-id="6ca69-172">Dobrze działa również w środowisku zespołu, jeśli jesteś jedyną osobą wprowadzającą zmiany w modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-172">It also works well in a team environment if you are the only person making changes to the model.</span></span> <span data-ttu-id="6ca69-173">W tym scenariuszu można wprowadzać zmiany modelu, generować migracje i przesyłać je do kontroli źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-173">In this scenario you can make model changes, generate migrations and submit them to your source control.</span></span> <span data-ttu-id="6ca69-174">Inni deweloperzy mogą synchronizować zmiany i uruchamiać **aktualizacje-Database** , aby zmiany schematu zostały zastosowane.</span><span class="sxs-lookup"><span data-stu-id="6ca69-174">Other developers can sync your changes and run **Update-Database** to have the schema changes applied.</span></span>

<span data-ttu-id="6ca69-175">Problemy zaczynają się w sytuacji, gdy wielu deweloperów wprowadza zmiany w modelu EF i jednocześnie przesyła do kontroli źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-175">Issues start to arise when you have multiple developers making changes to the EF model and submitting to source control at the same time.</span></span> <span data-ttu-id="6ca69-176">Brak elementów EF to pierwszy sposób scalania migracji lokalnych z migracjami, które inny deweloper przesłał do kontroli źródła od momentu ostatniej synchronizacji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-176">What EF lacks is a first class way to merge your local migrations with migrations that another developer has submitted to source control since you last synced.</span></span>

## <a name="an-example-of-a-merge-conflict"></a><span data-ttu-id="6ca69-177">Przykład konfliktu scalania</span><span class="sxs-lookup"><span data-stu-id="6ca69-177">An example of a merge conflict</span></span>

<span data-ttu-id="6ca69-178">Najpierw przyjrzyjmy się konkretnemu przykładowi konfliktu scalania.</span><span class="sxs-lookup"><span data-stu-id="6ca69-178">First let’s look at a concrete example of such a merge conflict.</span></span> <span data-ttu-id="6ca69-179">Będziemy dalej korzystać z przykładu, który oglądamy wcześniej.</span><span class="sxs-lookup"><span data-stu-id="6ca69-179">We’ll continue on with the example we looked at earlier.</span></span> <span data-ttu-id="6ca69-180">Jako punkt początkowy Załóżmy, że zmiany z poprzedniej sekcji zostały zaewidencjonowane przez oryginalnego dewelopera.</span><span class="sxs-lookup"><span data-stu-id="6ca69-180">As a starting point let’s assume the changes from the previous section were checked in by the original developer.</span></span> <span data-ttu-id="6ca69-181">Będziemy śledzić dwóch deweloperów w miarę wprowadzania zmian w bazie kodu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-181">We’ll track two developers as they make changes to code base.</span></span>

<span data-ttu-id="6ca69-182">Będziemy śledzić model EF i migracje przez wiele zmian.</span><span class="sxs-lookup"><span data-stu-id="6ca69-182">We’ll track the EF model and the migrations thru a number of changes.</span></span> <span data-ttu-id="6ca69-183">W przypadku punktu początkowego obydwie deweloperzy zostały zsynchronizowane z repozytorium kontroli źródła, jak przedstawiono na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-183">For a starting point, both developers have synced to the source control repository, as depicted in the following graphic.</span></span>

![Punkt początkowy](~/ef6/media/startingpoint.png)

<span data-ttu-id="6ca69-185">Deweloperzy \# 1 i Developer \# 2 wprowadzają teraz pewne zmiany w modelu EF w ich lokalnej bazie kodu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-185">Developer \#1 and developer \#2 now makes some changes to the EF model in their local code base.</span></span> <span data-ttu-id="6ca69-186">Deweloper \# 1 dodaje do **blogu** Właściwość **oceny** — i generuje migrację **addrating** , aby zastosować zmiany do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-186">Developer \#1 adds a **Rating** property to **Blog** – and generates an **AddRating** migration to apply the changes to the database.</span></span> <span data-ttu-id="6ca69-187">Deweloper \# 2 dodaje właściwość **czytelnicy** do **blogu** — i generuje odpowiednie migracje **addreader** .</span><span class="sxs-lookup"><span data-stu-id="6ca69-187">Developer \#2 adds a **Readers** property to **Blog** – and generates the corresponding **AddReaders** migration.</span></span> <span data-ttu-id="6ca69-188">Obaj deweloperzy uruchamiają **aktualizację bazy danych**, aby zastosować zmiany do ich lokalnych baz danych, a następnie kontynuować opracowywanie aplikacji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-188">Both developers run **Update-Database**, to apply the changes to their local databases, and then continue developing the application.</span></span>

> [!NOTE]
> <span data-ttu-id="6ca69-189">Migracje są poprzedzone sygnaturą czasową, więc nasza ilustracja przedstawia, że migracja addreader z dewelopera \# 2 jest dostępna po migracji addrating z dewelopera \# 1.</span><span class="sxs-lookup"><span data-stu-id="6ca69-189">Migrations are prefixed with a timestamp, so our graphic represents that the AddReaders migration from Developer \#2 comes after the AddRating migration from Developer \#1.</span></span> <span data-ttu-id="6ca69-190">Niezależnie od tego, czy deweloper \# 1 lub \# 2 wygenerował proces migracji, nie ma żadnego wpływu na problemy związane z pracą w zespole ani procesu scalania, który przeprowadzimy w następnej sekcji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-190">Whether developer \#1 or \#2 generated the migration first makes no difference to the issues of working in a team, or the process for merging them that we’ll look at in the next section.</span></span>

![Zmiany lokalne](~/ef6/media/localchanges.png)

<span data-ttu-id="6ca69-192">Jest to cieszymy dzień dla deweloperów \# 1, gdy nastąpiła najpierw przesłanie zmian.</span><span class="sxs-lookup"><span data-stu-id="6ca69-192">It’s a lucky day for Developer \#1 as they happen to submit their changes first.</span></span> <span data-ttu-id="6ca69-193">Ponieważ nikt inny nie zaewidencjonuje się, ponieważ synchronizuje swoje repozytorium, może po prostu przesłać zmiany bez wykonywania scalania.</span><span class="sxs-lookup"><span data-stu-id="6ca69-193">Because no one else has checked in since they synced their repository, they can just submit their changes without performing any merging.</span></span>

![Prześlij](~/ef6/media/submit.png)

<span data-ttu-id="6ca69-195">Teraz czas na \# przesłanie dewelopera 2.</span><span class="sxs-lookup"><span data-stu-id="6ca69-195">Now it’s time for Developer \#2 to submit.</span></span> <span data-ttu-id="6ca69-196">Nie cieszymy.</span><span class="sxs-lookup"><span data-stu-id="6ca69-196">They aren’t so lucky.</span></span> <span data-ttu-id="6ca69-197">Ponieważ ktoś inny przesłał zmiany od czasu ich synchronizacji, będzie musiał ściągnąć zmiany i scalić.</span><span class="sxs-lookup"><span data-stu-id="6ca69-197">Because someone else has submitted changes since they synced, they will need to pull down the changes and merge.</span></span> <span data-ttu-id="6ca69-198">System kontroli źródła prawdopodobnie będzie mógł automatycznie scalić zmiany na poziomie kodu, ponieważ są one bardzo proste.</span><span class="sxs-lookup"><span data-stu-id="6ca69-198">The source control system will likely be able to automatically merge the changes at the code level since they are very simple.</span></span> <span data-ttu-id="6ca69-199">Stan \# repozytorium lokalnego dewelopera 2 po synchronizacji przedstawiono na poniższej ilustracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-199">The state of Developer \#2’s local repository after syncing is depicted in the following graphic.</span></span> 

![Ściąganie](~/ef6/media/pull.png)

<span data-ttu-id="6ca69-201">Na tym etapie deweloper \# 2 może uruchomić program **Update-Database** , który wykryje nową migrację **addrating** (która nie została zastosowana do \# bazy danych dewelopera 2) i zastosuje ją.</span><span class="sxs-lookup"><span data-stu-id="6ca69-201">At this stage Developer \#2 can run **Update-Database** which will detect the new **AddRating** migration (which hasn’t been applied to Developer \#2’s database) and apply it.</span></span> <span data-ttu-id="6ca69-202">Teraz kolumna **Rating** zostanie dodana do tabeli **Blogi** , a baza danych jest zsynchronizowana z modelem.</span><span class="sxs-lookup"><span data-stu-id="6ca69-202">Now the **Rating** column is added to the **Blogs** table and the database is in sync with the model.</span></span>

<span data-ttu-id="6ca69-203">Istnieje kilka problemów, chociaż:</span><span class="sxs-lookup"><span data-stu-id="6ca69-203">There are a couple of problems though:</span></span>

1.  <span data-ttu-id="6ca69-204">Mimo że **Aktualizacja bazy danych** zostanie zastosowana do migracji **addrating** , zostanie również zgłoszone ostrzeżenie: *nie można zaktualizować bazy danych tak, aby była zgodna z bieżącym modelem, ponieważ istnieją oczekujące zmiany i automatyczna migracja jest wyłączona...*</span><span class="sxs-lookup"><span data-stu-id="6ca69-204">Although **Update-Database** will apply the **AddRating** migration it will also raise a warning: *Unable to update database to match the current model because there are pending changes and automatic migration is disabled…*</span></span>
    <span data-ttu-id="6ca69-205">Problem polega na tym, że migawka modelu przechowywana w ostatniej migracji (**Addreader**) nie zawiera właściwości **Rating** w **blogu** (ponieważ nie była częścią modelu podczas generowania migracji).</span><span class="sxs-lookup"><span data-stu-id="6ca69-205">The problem is that the model snapshot stored in the last migration (**AddReader**) is missing the **Rating** property on **Blog** (since it wasn’t part of the model when the migration was generated).</span></span> <span data-ttu-id="6ca69-206">Code First wykryje, że model w ostatniej migracji nie jest zgodny z bieżącym modelem i generuje ostrzeżenie.</span><span class="sxs-lookup"><span data-stu-id="6ca69-206">Code First detects that the model in the last migration doesn’t match the current model and raises the warning.</span></span>
2.  <span data-ttu-id="6ca69-207">Uruchomienie aplikacji spowoduje, że zostanie InvalidOperationException, że "*model z kopią zapasową kontekstu" BloggingContext "został zmieniony od czasu utworzenia bazy danych. Rozważ użycie Migracje Code First do zaktualizowania bazy danych... "*</span><span class="sxs-lookup"><span data-stu-id="6ca69-207">Running the application would result in an InvalidOperationException stating that “*The model backing the 'BloggingContext' context has changed since the database was created. Consider using Code First Migrations to update the database…”*</span></span>
    <span data-ttu-id="6ca69-208">Problem polega na tym, że migawka modelu przechowywana w ostatniej migracji nie jest zgodna z bieżącym modelem.</span><span class="sxs-lookup"><span data-stu-id="6ca69-208">Again, the problem is the model snapshot stored in the last migration doesn’t match the current model.</span></span>
3.  <span data-ttu-id="6ca69-209">Na koniec oczekujemy, że operacja **Add-Migration** spowoduje wygenerowanie pustej migracji (ponieważ nie ma zmian do zastosowania do bazy danych).</span><span class="sxs-lookup"><span data-stu-id="6ca69-209">Finally, we would expect running **Add-Migration** now would generate an empty migration (since there are no changes to apply to the database).</span></span> <span data-ttu-id="6ca69-210">Jednak ponieważ migracja porównuje bieżący model z tą z ostatniej migracji (w której brakuje właściwości **Rating** ), w rzeczywistości będzie szkieletować inne wywołanie **addColumn** do dodania w kolumnie **Rating** .</span><span class="sxs-lookup"><span data-stu-id="6ca69-210">But because migrations compares the current model to the one from the last migration (which is missing the **Rating** property) it will actually scaffold another **AddColumn** call to add in the **Rating** column.</span></span> <span data-ttu-id="6ca69-211">Oczywiście ta migracja nie powiedzie się podczas **aktualizacji bazy danych** , ponieważ kolumna **klasyfikacji** już istnieje.</span><span class="sxs-lookup"><span data-stu-id="6ca69-211">Of course, this migration would fail during **Update-Database** because the **Rating** column already exists.</span></span>

## <a name="resolving-the-merge-conflict"></a><span data-ttu-id="6ca69-212">Rozwiązywanie konfliktu scalania</span><span class="sxs-lookup"><span data-stu-id="6ca69-212">Resolving the merge conflict</span></span>

<span data-ttu-id="6ca69-213">Dobrą wiedzą, że nie jest zbyt trudne do rozdzielenia z scalaniem ręcznie — pod warunkiem, że wiesz, jak działa migracja.</span><span class="sxs-lookup"><span data-stu-id="6ca69-213">The good news is that it’s not too hard to deal with the merge manually – provided you have an understanding of how migrations works.</span></span> <span data-ttu-id="6ca69-214">Dlatego jeśli pominięto w tej sekcji...</span><span class="sxs-lookup"><span data-stu-id="6ca69-214">So if you’ve skipped ahead to this section…</span></span> <span data-ttu-id="6ca69-215">Niestety, musisz najpierw wrócić do pozostałej części artykułu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-215">sorry, you need to go back and read the rest of the article first!</span></span>

<span data-ttu-id="6ca69-216">Dostępne są dwie opcje, najłatwiej jest wygenerować pustą migrację, która ma prawidłowy bieżący model jako migawkę.</span><span class="sxs-lookup"><span data-stu-id="6ca69-216">There are two options, the easiest is to generate a blank migration that has the correct current model as a snapshot.</span></span> <span data-ttu-id="6ca69-217">Druga opcja polega na aktualizacji migawki w ostatniej migracji w celu uzyskania poprawnej migawki modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-217">The second option is to update the snapshot in the last migration to have the correct model snapshot.</span></span> <span data-ttu-id="6ca69-218">Druga opcja jest nieco trudniejsza i nie może być używana w każdym scenariuszu, ale jest również przejrzysta, ponieważ nie obejmuje dodawania dodatkowej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-218">The second option is a little harder and can’t be used in every scenario, but it’s also cleaner because it doesn’t involve adding an extra migration.</span></span>

### <a name="option-1-add-a-blank-merge-migration"></a><span data-ttu-id="6ca69-219">Opcja 1: Dodanie pustej migracji "merge"</span><span class="sxs-lookup"><span data-stu-id="6ca69-219">Option 1: Add a blank ‘merge’ migration</span></span>

<span data-ttu-id="6ca69-220">W tej opcji wygenerujemy pustą migrację wyłącznie na potrzeby upewnienia się, że w ramach najnowszej migracji Zapisano poprawną migawkę modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-220">In this option we generate a blank migration solely for the purpose of making sure the latest migration has the correct model snapshot stored in it.</span></span>

<span data-ttu-id="6ca69-221">Tej opcji można użyć niezależnie od tego, kto wygenerował ostatnią migrację.</span><span class="sxs-lookup"><span data-stu-id="6ca69-221">This option can be used regardless of who generated the last migration.</span></span> <span data-ttu-id="6ca69-222">W przykładzie, który został uruchomiony przez dewelopera \# 2, zajmiemy się scalaniem i wystąpiły one w celu wygenerowania ostatniej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-222">In the example we’ve been following Developer \#2 is taking care of the merge and they happened to generate the last migration.</span></span> <span data-ttu-id="6ca69-223">Jednak te same kroki mogą być używane, jeśli deweloper \# 1 wygenerował ostatnią migrację.</span><span class="sxs-lookup"><span data-stu-id="6ca69-223">But these same steps can be used if Developer \#1 generated the last migration.</span></span> <span data-ttu-id="6ca69-224">Te kroki mają zastosowanie również w przypadku istnienia wielu migracji, w celu ich prostego przeprowadzenia.</span><span class="sxs-lookup"><span data-stu-id="6ca69-224">The steps also apply if there are multiple migrations involved – we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="6ca69-225">Następujący proces może służyć do tego podejścia, od momentu wprowadzenia zmian, które muszą zostać zsynchronizowane z kontroli źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-225">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="6ca69-226">Upewnij się, że wszystkie oczekujące zmiany modelu w lokalnej bazie kodu zostały zapisaną do migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-226">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="6ca69-227">Ten krok gwarantuje, że nie zostaną pominięte żadne uzasadnione zmiany, gdy nadejdzie czas na wygenerowanie pustej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-227">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="6ca69-228">Synchronizuj z kontrolą źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-228">Sync with source control.</span></span>
3.  <span data-ttu-id="6ca69-229">Uruchom opcję **Update-Database** , aby zastosować nowe migracje, które zostały zaewidencjonowane przez innych deweloperów.</span><span class="sxs-lookup"><span data-stu-id="6ca69-229">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="6ca69-230">**_Uwaga:_** *Jeśli nie otrzymasz żadnych ostrzeżeń z polecenia Update-Database, nie było żadnych nowych migracji od innych deweloperów i nie ma potrzeby wykonywania dalszych scalania.*</span><span class="sxs-lookup"><span data-stu-id="6ca69-230">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="6ca69-231">Uruchom polecenie **Add- &lt; Migration \_ Wybierz \_ nazwę &gt; – IgnoreChanges** (na przykład polecenie **Add-Migration Merge – IgnoreChanges**).</span><span class="sxs-lookup"><span data-stu-id="6ca69-231">Run **Add-Migration &lt;pick\_a\_name&gt; –IgnoreChanges** (for example, **Add-Migration Merge –IgnoreChanges**).</span></span> <span data-ttu-id="6ca69-232">Spowoduje to wygenerowanie migracji ze wszystkimi metadanymi (łącznie z migawką bieżącego modelu), ale zignoruje wszelkie zmiany, które wykryje podczas porównywania bieżącego modelu z migawką w ostatniej migracji (co oznacza, że można uzyskać pustą metodę w **górę** i **w dół** ).</span><span class="sxs-lookup"><span data-stu-id="6ca69-232">This generates a migration with all the metadata (including a snapshot of the current model) but will ignore any changes it detects when comparing the current model to the snapshot in the last migrations (meaning you get a blank **Up** and **Down** method).</span></span>
5.  <span data-ttu-id="6ca69-233">Uruchom **aktualizację-Database** , aby ponownie zastosować najnowszą migrację ze zaktualizowanymi metadanymi.</span><span class="sxs-lookup"><span data-stu-id="6ca69-233">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
6.  <span data-ttu-id="6ca69-234">Kontynuuj opracowywanie lub Prześlij do kontroli źródła (po uruchomieniu testów jednostkowych kursu).</span><span class="sxs-lookup"><span data-stu-id="6ca69-234">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="6ca69-235">Poniżej znajduje się stan \# lokalnej bazy kodu dewelopera 2 po użyciu tego podejścia.</span><span class="sxs-lookup"><span data-stu-id="6ca69-235">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Scalanie migracji](~/ef6/media/mergemigration.png)

### <a name="option-2-update-the-model-snapshot-in-the-last-migration"></a><span data-ttu-id="6ca69-237">Opcja 2: aktualizowanie migawki modelu w ostatniej migracji</span><span class="sxs-lookup"><span data-stu-id="6ca69-237">Option 2: Update the model snapshot in the last migration</span></span>

<span data-ttu-id="6ca69-238">Ta opcja jest bardzo podobna do opcji 1, ale eliminuje dodatkową migrację pustą — ponieważ będzie ona zależeć od tego, kto chce uzyskać dodatkowe pliki kodu w rozwiązaniu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-238">This option is very similar to option 1 but removes the extra blank migration – because let’s face it, who wants extra code files in their solution.</span></span>

<span data-ttu-id="6ca69-239">**Takie podejście jest możliwe tylko wtedy, gdy Najnowsza migracja istnieje tylko w bazie kodu lokalnego i nie została jeszcze przesłana do kontroli źródła (na przykład jeśli Ostatnia migracja została wygenerowana przez użytkownika wykonującego scalanie)**.</span><span class="sxs-lookup"><span data-stu-id="6ca69-239">**This approach is only feasible if the latest migration exists only in your local code base and has not yet been submitted to source control (for example, if the last migration was generated by the user doing the merge)**.</span></span> <span data-ttu-id="6ca69-240">Edytowanie metadanych migracji, które mogą już być stosowane przez innych deweloperów, lub nawet gorszenia zastosowania do produkcyjnej bazy danych — może spowodować nieoczekiwane skutki uboczne.</span><span class="sxs-lookup"><span data-stu-id="6ca69-240">Editing the metadata of migrations that other developers may have already applied to their development database – or even worse applied to a production database – can result in unexpected side effects.</span></span> <span data-ttu-id="6ca69-241">Podczas procesu wycofywanie ostatniej migracji z lokalnej bazy danych i ponowne zastosowanie jej przy użyciu zaktualizowanych metadanych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-241">During the process we’re going to roll back the last migration in our local database and re-apply it with updated metadata.</span></span>

<span data-ttu-id="6ca69-242">Podczas gdy Ostatnia migracja musi znajdować się w bazie kodu lokalnego, nie ma żadnych ograniczeń dotyczących liczby lub kolejności migracji, które go przechodzą.</span><span class="sxs-lookup"><span data-stu-id="6ca69-242">While the last migration needs to just be in the local code base there are no restrictions to the number or order of migrations that proceed it.</span></span> <span data-ttu-id="6ca69-243">Może istnieć wiele migracji od wielu różnych deweloperów i te same kroki — przeszukamy dwie, aby zachować prostotę.</span><span class="sxs-lookup"><span data-stu-id="6ca69-243">There can be multiple migrations from multiple different developers and the same steps apply– we’ve just been looking at two in order to keep it simple.</span></span>

<span data-ttu-id="6ca69-244">Następujący proces może służyć do tego podejścia, od momentu wprowadzenia zmian, które muszą zostać zsynchronizowane z kontroli źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-244">The following process can be used for this approach, starting from the time you realize you have changes that need to be synced from source control.</span></span>

1.  <span data-ttu-id="6ca69-245">Upewnij się, że wszystkie oczekujące zmiany modelu w lokalnej bazie kodu zostały zapisaną do migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-245">Ensure any pending model changes in your local code base have been written to a migration.</span></span> <span data-ttu-id="6ca69-246">Ten krok gwarantuje, że nie zostaną pominięte żadne uzasadnione zmiany, gdy nadejdzie czas na wygenerowanie pustej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-246">This step ensures you don’t miss any legitimate changes when it comes time to generate the blank migration.</span></span>
2.  <span data-ttu-id="6ca69-247">Synchronizuj z kontrolą źródła.</span><span class="sxs-lookup"><span data-stu-id="6ca69-247">Sync with the source control.</span></span>
3.  <span data-ttu-id="6ca69-248">Uruchom opcję **Update-Database** , aby zastosować nowe migracje, które zostały zaewidencjonowane przez innych deweloperów.</span><span class="sxs-lookup"><span data-stu-id="6ca69-248">Run **Update-Database** to apply any new migrations that other developers have checked in.</span></span>
    <span data-ttu-id="6ca69-249">**_Uwaga:_** *Jeśli nie otrzymasz żadnych ostrzeżeń z polecenia Update-Database, nie było żadnych nowych migracji od innych deweloperów i nie ma potrzeby wykonywania dalszych scalania.*</span><span class="sxs-lookup"><span data-stu-id="6ca69-249">**_Note:_** *if you don’t get any warnings from the Update-Database command then there were no new migrations from other developers and there is no need to perform any further merging.*</span></span>
4.  <span data-ttu-id="6ca69-250">Uruchom \*\*Update-Database – TargetMigration &lt; sekundę \_ Ostatnia \_ migracja &gt; \*\* (w przykładzie poniżej zostałaby to **Aktualizacja-Database – TargetMigration addrating**).</span><span class="sxs-lookup"><span data-stu-id="6ca69-250">Run **Update-Database –TargetMigration &lt;second\_last\_migration&gt;** (in the example we’ve been following this would be **Update-Database –TargetMigration AddRating**).</span></span> <span data-ttu-id="6ca69-251">Spowoduje to przywrócenie bazy danych z powrotem do stanu drugiej ostatniej migracji — w praktyce "cofnięto stosowanie" ostatniej migracji z bazy danych.</span><span class="sxs-lookup"><span data-stu-id="6ca69-251">This rolls the database back to the state of the second last migration – effectively ‘un-applying’ the last migration from the database.</span></span>
    <span data-ttu-id="6ca69-252">**_Uwaga:_** *ten krok jest wymagany, aby można było bezpiecznie edytować metadane migracji, ponieważ metadane są również przechowywane w \_ \_ MigrationsHistoryTable bazy danych. Dlatego należy używać tej opcji tylko wtedy, gdy Ostatnia migracja jest tylko w lokalnej bazie kodu. Jeśli podczas ostatniej zastosowanej migracji istnieją inne bazy danych, należy również ponownie je wycofać i zastosować ostatniej migracji w celu zaktualizowania metadanych.*</span><span class="sxs-lookup"><span data-stu-id="6ca69-252">**_Note:_** *This step is required to make it safe to edit the metadata of the migration since the metadata is also stored in the \_\_MigrationsHistoryTable of the database. This is why you should only use this option if the last migration is only in your local code base. If other databases had the last migration applied you would also have to roll them back and re-apply the last migration to update the metadata.*</span></span> 
5.  <span data-ttu-id="6ca69-253">Uruchom \*\* &lt; pełną nazwę migracji z \_ \_ uwzględnieniem \_ sygnatury czasowej \_ \_ ostatniej \_ migracji\*\* &gt; (w przykładzie, w którym został on wykonany, będzie coś takiego jak **Add-Migration 201311062215252 \_ addreader**).</span><span class="sxs-lookup"><span data-stu-id="6ca69-253">Run **Add-Migration &lt;full\_name\_including\_timestamp\_of\_last\_migration**&gt; (in the example we’ve been following this would be something like **Add-Migration 201311062215252\_AddReaders**).</span></span>
    <span data-ttu-id="6ca69-254">**_Uwaga:_** należy *dołączyć sygnaturę czasową, aby migracja wiedziała, że chcesz edytować istniejącą migrację, a nie utworzyć szkieletu nowej.*</span><span class="sxs-lookup"><span data-stu-id="6ca69-254">**_Note:_** *You need to include the timestamp so that migrations knows you want to edit the existing migration rather than scaffolding a new one.*</span></span>
    <span data-ttu-id="6ca69-255">Spowoduje to zaktualizowanie metadanych ostatniej migracji w celu dopasowania do bieżącego modelu.</span><span class="sxs-lookup"><span data-stu-id="6ca69-255">This will update the metadata for the last migration to match the current model.</span></span> <span data-ttu-id="6ca69-256">Po zakończeniu wykonywania polecenia otrzymasz następujące ostrzeżenie, ale to dokładnie to, czego potrzebujesz.</span><span class="sxs-lookup"><span data-stu-id="6ca69-256">You’ll get the following warning when the command completes, but that’s exactly what you want.</span></span> <span data-ttu-id="6ca69-257">"*Został utworzony ponowny szkielet" tylko kod projektanta dla migracji "201311062215252 \_ addreader". Aby przeprowadzić ponowną próbę przetworzenia szkieletu całej migracji, użyj parametru-Force.*</span><span class="sxs-lookup"><span data-stu-id="6ca69-257">“*Only the Designer Code for migration '201311062215252\_AddReaders' was re-scaffolded. To re-scaffold the entire migration, use the -Force parameter.”*</span></span>
6.  <span data-ttu-id="6ca69-258">Uruchom **aktualizację-Database** , aby ponownie zastosować najnowszą migrację ze zaktualizowanymi metadanymi.</span><span class="sxs-lookup"><span data-stu-id="6ca69-258">Run **Update-Database** to re-apply the latest migration with the updated metadata.</span></span>
7.  <span data-ttu-id="6ca69-259">Kontynuuj opracowywanie lub Prześlij do kontroli źródła (po uruchomieniu testów jednostkowych kursu).</span><span class="sxs-lookup"><span data-stu-id="6ca69-259">Continue developing, or submit to source control (after running your unit tests of course).</span></span>

<span data-ttu-id="6ca69-260">Poniżej znajduje się stan \# lokalnej bazy kodu dewelopera 2 po użyciu tego podejścia.</span><span class="sxs-lookup"><span data-stu-id="6ca69-260">Here is the state of Developer \#2’s local code base after using this approach.</span></span>

![Zaktualizowane metadane](~/ef6/media/updatedmetadata.png)

## <a name="summary"></a><span data-ttu-id="6ca69-262">Podsumowanie</span><span class="sxs-lookup"><span data-stu-id="6ca69-262">Summary</span></span>

<span data-ttu-id="6ca69-263">Korzystanie z Migracje Code First w środowisku zespołu ma pewne problemy.</span><span class="sxs-lookup"><span data-stu-id="6ca69-263">There are some challenges when using Code First Migrations in a team environment.</span></span> <span data-ttu-id="6ca69-264">Jednak podstawowe informacje dotyczące sposobu działania migracji oraz kilka prostych metod rozwiązywania konfliktów scalania ułatwiają pokonanie tych wyzwań.</span><span class="sxs-lookup"><span data-stu-id="6ca69-264">However, a basic understanding of how migrations works and some simple approaches for resolving merge conflicts make it easy to overcome these challenges.</span></span>

<span data-ttu-id="6ca69-265">Podstawowy problem dotyczy nieprawidłowych metadanych przechowywanych w najnowszej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-265">The fundamental issue is incorrect metadata stored in the latest migration.</span></span> <span data-ttu-id="6ca69-266">Powoduje to, że Code First nieprawidłowo wykryć, że bieżący model i schemat bazy danych nie są zgodne, i aby przeprowadzić szkielet niepoprawnego kodu podczas następnej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-266">This causes Code First to incorrectly detect that the current model and database schema don’t match and to scaffold incorrect code in the next migration.</span></span> <span data-ttu-id="6ca69-267">Tę sytuację można rozwiązać przez wygenerowanie pustej migracji z odpowiednim modelem lub zaktualizowanie metadanych w najnowszej migracji.</span><span class="sxs-lookup"><span data-stu-id="6ca69-267">This situation can be overcome by generating a blank migration with the correct model, or updating the metadata in the latest migration.</span></span>
