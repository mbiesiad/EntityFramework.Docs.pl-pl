---
title: Jednostki samośledzenia — EF6
author: divega
ms.date: 10/23/2016
ms.assetid: 5e60f5be-7bbb-4bf8-835e-0ac808d6c84a
ms.openlocfilehash: 3bb9759d89fbd0c10b911625aa7d0afd7747de14
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78419524"
---
# <a name="self-tracking-entities"></a><span data-ttu-id="ccc7a-102">Jednostki samośledzenia</span><span class="sxs-lookup"><span data-stu-id="ccc7a-102">Self-tracking entities</span></span>

> [!IMPORTANT]
> <span data-ttu-id="ccc7a-103">Nie zalecamy już korzystania z szablonu samośledzenia jednostek.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-103">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="ccc7a-104">Będzie ona nadal dostępna tylko do obsługi istniejących aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-104">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="ccc7a-105">Jeśli aplikacja wymaga pracy z odłączonymi wykresami jednostek, należy wziąć pod uwagę inne alternatywy, takie jak [śledzone jednostki](https://trackableentities.github.io/), które są technologią podobną do samodzielnego śledzenia jednostek, które są opracowywane przez społeczność lub piszą kod niestandardowy przy użyciu interfejsów API śledzenia zmian niskiego poziomu.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-105">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="ccc7a-106">W aplikacji opartej na Entity Framework kontekście jest odpowiedzialny za śledzenie zmian w obiektach.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-106">In an Entity Framework-based application, a context is responsible for tracking changes in your objects.</span></span> <span data-ttu-id="ccc7a-107">Następnie należy użyć metody metody SaveChanges, aby zachować zmiany w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-107">You then use the SaveChanges method to persist the changes to the database.</span></span> <span data-ttu-id="ccc7a-108">W przypadku korzystania z aplikacji N-warstwowych obiekty jednostek są zazwyczaj odłączane od kontekstu i należy zdecydować, jak śledzić zmiany i raportować te zmiany z powrotem do kontekstu.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-108">When working with N-Tier applications, the entity objects are usually disconnected from the context and you must decide how to track changes and report those changes back to the context.</span></span> <span data-ttu-id="ccc7a-109">Jednostki samodzielnego śledzenia (inżynierów Ste) mogą pomóc w śledzeniu zmian w dowolnej warstwie, a następnie powtórzeniu tych zmian w kontekście, który ma zostać zapisany.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-109">Self-Tracking Entities (STEs) can help you track changes in any tier and then replay these changes into a context to be saved.</span></span>  

<span data-ttu-id="ccc7a-110">Używaj inżynierów Ste tylko wtedy, gdy kontekst nie jest dostępny w warstwie, w której są wykonywane zmiany grafu obiektów.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-110">Use STEs only if the context is not available on a tier where the changes to the object graph are made.</span></span> <span data-ttu-id="ccc7a-111">Jeśli kontekst jest dostępny, nie ma potrzeby używania inżynierów Ste, ponieważ kontekst zajmie się śledzeniem zmian.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-111">If the context is available, there is no need to use STEs because the context will take care of tracking changes.</span></span>  

<span data-ttu-id="ccc7a-112">Ten element szablonu generuje dwa pliki TT (szablon tekstowy):</span><span class="sxs-lookup"><span data-stu-id="ccc7a-112">This template item generates two .tt (text template) files:</span></span>  

- <span data-ttu-id="ccc7a-113">**Nazwa modelu\<\>plik TT** generuje typy jednostek i klasę pomocnika, która zawiera logikę śledzenia zmian, która jest używana przez jednostki samośledzenia i metody rozszerzające, które zezwalają na Ustawianie stanu dla jednostek samodzielnego śledzenia.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-113">The **\<model name\>.tt** file generates the entity types and a helper class that contains the change-tracking logic that is used by self-tracking entities and the extension methods that allow setting state on self-tracking entities.</span></span>  
- <span data-ttu-id="ccc7a-114">**\>nazwy modelu\<. Plik Context.tt** generuje kontekst pochodny i klasę rozszerzenia, która zawiera **metody ApplyChanges —** dla klas **ObjectContext** i **ObjectSet** .</span><span class="sxs-lookup"><span data-stu-id="ccc7a-114">The **\<model name\>.Context.tt** file generates a derived context and an extension class that contains **ApplyChanges** methods for the **ObjectContext** and **ObjectSet** classes.</span></span> <span data-ttu-id="ccc7a-115">Te metody sprawdzają informacje o śledzeniu zmian, które są zawarte na grafie jednostek samodzielnego śledzenia, aby wywnioskować zestaw operacji, które należy wykonać w celu zapisania zmian w bazie danych.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-115">These methods examine the change-tracking information that is contained in the graph of self-tracking entities to infer the set of operations that must be performed to save the changes in the database.</span></span>  

## <a name="get-started"></a><span data-ttu-id="ccc7a-116">Rozpoczęcie pracy</span><span class="sxs-lookup"><span data-stu-id="ccc7a-116">Get Started</span></span>  

<span data-ttu-id="ccc7a-117">Aby rozpocząć, odwiedź stronę [przewodnika Samośledzenia jednostek](walkthrough.md) .</span><span class="sxs-lookup"><span data-stu-id="ccc7a-117">To get started, visit the [Self-Tracking Entities Walkthrough](walkthrough.md) page.</span></span>  

## <a name="functional-considerations-when-working-with-self-tracking-entities"></a><span data-ttu-id="ccc7a-118">Zagadnienia funkcjonalne podczas pracy z jednostkami samośledzenia</span><span class="sxs-lookup"><span data-stu-id="ccc7a-118">Functional Considerations When Working with Self-Tracking Entities</span></span>  
> [!IMPORTANT]
> <span data-ttu-id="ccc7a-119">Nie zalecamy już korzystania z szablonu samośledzenia jednostek.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-119">We no longer recommend using the self-tracking-entities template.</span></span> <span data-ttu-id="ccc7a-120">Będzie ona nadal dostępna tylko do obsługi istniejących aplikacji.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-120">It will only continue to be available to support existing applications.</span></span> <span data-ttu-id="ccc7a-121">Jeśli aplikacja wymaga pracy z odłączonymi wykresami jednostek, należy wziąć pod uwagę inne alternatywy, takie jak [śledzone jednostki](https://trackableentities.github.io/), które są technologią podobną do samodzielnego śledzenia jednostek, które są opracowywane przez społeczność lub piszą kod niestandardowy przy użyciu interfejsów API śledzenia zmian niskiego poziomu.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-121">If your application requires working with disconnected graphs of entities, consider other alternatives such as [Trackable Entities](https://trackableentities.github.io/), which is a technology similar to Self-Tracking-Entities that is more actively developed by the community, or writing custom code using the low-level change tracking APIs.</span></span>

<span data-ttu-id="ccc7a-122">Podczas pracy z jednostkami samośledzenia należy wziąć pod uwagę następujące kwestie:</span><span class="sxs-lookup"><span data-stu-id="ccc7a-122">Consider the following when working with self-tracking entities:</span></span>  

- <span data-ttu-id="ccc7a-123">Upewnij się, że projekt klienta zawiera odwołanie do zestawu zawierającego typy jednostek.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-123">Make sure that your client project has a reference to the assembly containing the entity types.</span></span> <span data-ttu-id="ccc7a-124">W przypadku dodania do projektu klienta tylko odwołania do usługi, projekt klienta będzie używać typów serwera proxy WCF, a nie rzeczywistych typów jednostek samośledzenia.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-124">If you add only the service reference to the client project, the client project will use the WCF proxy types and not the actual self-tracking entity types.</span></span> <span data-ttu-id="ccc7a-125">Oznacza to, że nie zostaną wyświetlone funkcje powiadomień automatycznych, które zarządzają śledzeniem jednostek na kliencie.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-125">This means that you will not get the automated notification features that manage the tracking of the entities on the client.</span></span> <span data-ttu-id="ccc7a-126">Jeśli celowo nie chcesz uwzględniać typów jednostek, musisz ręcznie ustawić informacje o śledzeniu zmian na kliencie, aby zmiany zostały wysłane z powrotem do usługi.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-126">If you intentionally do not want to include the entity types, you will have to manually set change-tracking information on the client for the changes to be sent back to the service.</span></span>  
- <span data-ttu-id="ccc7a-127">Wywołania operacji usługi powinny być bezstanowe i utworzyć nowe wystąpienie kontekstu obiektu.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-127">Calls to the service operation should be stateless and create a new instance of object context.</span></span> <span data-ttu-id="ccc7a-128">Zalecamy również utworzenie kontekstu obiektu w bloku **using** .</span><span class="sxs-lookup"><span data-stu-id="ccc7a-128">We also recommend that you create object context in a **using** block.</span></span>  
- <span data-ttu-id="ccc7a-129">Po wysłaniu grafu, który został zmodyfikowany na kliencie do usługi, a następnie chcesz kontynuować pracę z tym samym wykresem na kliencie, musisz ręcznie wykonać iterację w grafie i wywołać metodę **AcceptChanges** dla każdego obiektu, aby zresetować śledzenie zmian.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-129">When you send the graph that was modified on the client to the service and then intend to continue working with the same graph on the client, you have to manually iterate through the graph and call the **AcceptChanges** method on each object to reset the change tracker.</span></span>  

    > <span data-ttu-id="ccc7a-130">Jeśli obiekty w grafie zawierają właściwości z wartościami generowanymi przez bazę danych (na przykład tożsamości lub wartości współbieżności), Entity Framework zastąpią wartości tych właściwości wartościami wygenerowanymi przez bazę danych po wywołaniu metody **metody SaveChanges** .</span><span class="sxs-lookup"><span data-stu-id="ccc7a-130">If objects in your graph contain properties with database-generated values (for example, identity or concurrency values), Entity Framework will replace values of these properties with the database-generated values after the **SaveChanges** method is called.</span></span> <span data-ttu-id="ccc7a-131">Możesz zaimplementować operację usługi w celu zwrócenia zapisywanych obiektów lub listy wygenerowanych wartości właściwości dla obiektów z powrotem do klienta.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-131">You can implement your service operation to return saved objects or a list of generated property values for the objects back to the client.</span></span> <span data-ttu-id="ccc7a-132">Następnie klient musi zamienić wystąpienia obiektu lub wartości właściwości obiektu na wartości obiektów lub właściwości zwróconych z operacji usługi.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-132">The client would then need to replace the object instances or object property values with the objects or property values returned from the service operation.</span></span>  
- <span data-ttu-id="ccc7a-133">Scalanie wykresów z wielu żądań obsługi może spowodować, że obiekty mające zduplikowane wartości klucza na wykresie wyników.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-133">Merging graphs from multiple service requests may introduce objects with duplicate key values in the resulting graph.</span></span> <span data-ttu-id="ccc7a-134">Entity Framework nie usuwa obiektów ze zduplikowanymi kluczami podczas wywoływania metody **ApplyChanges —** , ale zamiast tego zgłasza wyjątek.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-134">Entity Framework does not remove the objects with duplicate keys when you call the **ApplyChanges** method but instead throws an exception.</span></span> <span data-ttu-id="ccc7a-135">Aby uniknąć, że wykresy o zduplikowanych wartościach klucza są zgodne z wzorcem opisanym w następującym blogu: [jednostki samośledzące: ApplyChanges — i zduplikowane jednostki](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="ccc7a-135">To avoid having graphs with duplicate key values follow one of the patterns described in the following blog: [Self-Tracking Entities: ApplyChanges and duplicate entities](https://go.microsoft.com/fwlink/?LinkID=205119&clcid=0x409).</span></span>  
- <span data-ttu-id="ccc7a-136">W przypadku zmiany relacji między obiektami przez ustawienie właściwości klucza obcego właściwość nawigacji odwołania ma wartość null i nie jest zsynchronizowana z odpowiednią jednostką główną na komputerze klienckim.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-136">When you change the relationship between objects by setting the foreign key property, the reference navigation property is set to null and not synchronized to the appropriate principal entity on the client.</span></span> <span data-ttu-id="ccc7a-137">Po dołączeniu grafu do kontekstu obiektu (na przykład po wywołaniu metody **ApplyChanges —** ) właściwości klucza obcego i właściwości nawigacji są synchronizowane.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-137">After the graph is attached to the object context (for example, after you call the **ApplyChanges** method), the foreign key properties and navigation properties are synchronized.</span></span>  

    > <span data-ttu-id="ccc7a-138">Nie ma właściwości nawigacji referencyjnej synchronizowanej z odpowiednim obiektem Principal może być problemem, jeśli określono kaskadowe usuwanie w relacji klucza obcego.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-138">Not having a reference navigation property synchronized with the appropriate principal object could be an issue if you have specified cascade delete on the foreign key relationship.</span></span> <span data-ttu-id="ccc7a-139">Usunięcie podmiotu zabezpieczeń spowoduje, że usunięcie nie zostanie propagowane do obiektów zależnych.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-139">If you delete the principal, the delete will not be propagated to the dependent objects.</span></span> <span data-ttu-id="ccc7a-140">Jeśli określono kaskadowe usuwanie, użyj właściwości nawigacji, aby zmienić relacje zamiast ustawiania właściwości klucza obcego.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-140">If you have cascade deletes specified, use navigation properties to change relationships instead of setting the foreign key property.</span></span>  
- <span data-ttu-id="ccc7a-141">Jednostki samośledzące nie są włączone, aby wykonać ładowanie z opóźnieniem.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-141">Self-tracking entities are not enabled to perform lazy loading.</span></span>  
- <span data-ttu-id="ccc7a-142">Serializacja binarna i Serializacja do obiektów ASP.NET State Management nie są obsługiwane przez jednostki samośledzenia.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-142">Binary serialization and serialization to ASP.NET state management objects is not supported by self-tracking entities.</span></span> <span data-ttu-id="ccc7a-143">Można jednak dostosować szablon, aby dodać obsługę serializacji binarnej.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-143">However, you can customize the template to add the binary serialization support.</span></span> <span data-ttu-id="ccc7a-144">Aby uzyskać więcej informacji, zobacz [Używanie serializacji binarnej i elementu ViewState z jednostkami samośledzenia](https://go.microsoft.com/fwlink/?LinkId=199208).</span><span class="sxs-lookup"><span data-stu-id="ccc7a-144">For more information, see [Using Binary Serialization and ViewState with Self-Tracking Entities](https://go.microsoft.com/fwlink/?LinkId=199208).</span></span>  

## <a name="security-considerations"></a><span data-ttu-id="ccc7a-145">Zagadnienia związane z zabezpieczeniami</span><span class="sxs-lookup"><span data-stu-id="ccc7a-145">Security Considerations</span></span>  

<span data-ttu-id="ccc7a-146">Podczas pracy z jednostkami samodzielnego śledzenia należy wziąć pod uwagę następujące zagadnienia dotyczące zabezpieczeń:</span><span class="sxs-lookup"><span data-stu-id="ccc7a-146">The following security considerations should be taken into account when working with self-tracking entities:</span></span>  

- <span data-ttu-id="ccc7a-147">Usługa nie powinna ufać żądaniami pobierania lub aktualizowania danych z niezaufanego klienta lub niezaufanego kanału.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-147">A service should not trust requests to retrieve or update data from a non-trusted client or through a non-trusted channel.</span></span> <span data-ttu-id="ccc7a-148">Klient musi zostać uwierzytelniony: należy użyć bezpiecznego kanału lub koperty komunikatów.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-148">A client must be authenticated: a secure channel or message envelope should be used.</span></span> <span data-ttu-id="ccc7a-149">Żądania klientów dotyczące aktualizowania lub pobierania danych muszą zostać sprawdzone, aby upewnić się, że są one zgodne z oczekiwanymi i uzasadnionymi zmianami w danym scenariuszu.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-149">Clients' requests to update or retrieve data must be validated to ensure they conform to expected and legitimate changes for the given scenario.</span></span>  
- <span data-ttu-id="ccc7a-150">Unikaj używania poufnych informacji jako kluczy jednostek (na przykład numerów ubezpieczenia społecznego).</span><span class="sxs-lookup"><span data-stu-id="ccc7a-150">Avoid using sensitive information as entity keys (for example, social security numbers).</span></span> <span data-ttu-id="ccc7a-151">Pozwala to ograniczyć możliwość przypadkowego serializacji informacji poufnych na wykresach jednostek, które nie są w pełni zaufane.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-151">This mitigates the possibility of inadvertently serializing sensitive information in the self-tracking entity graphs to a client that is not fully trusted.</span></span> <span data-ttu-id="ccc7a-152">Z niezależnymi skojarzeniami oryginalny klucz jednostki powiązanej z tym, który jest serializowany, może być również wysyłany do klienta.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-152">With independent associations, the original key of an entity that is related to the one that is being serialized might be sent to the client as well.</span></span>  
- <span data-ttu-id="ccc7a-153">Aby uniknąć propagowania komunikatów o wyjątkach zawierających dane poufne do warstwy klienta, wywołania do **ApplyChanges —** i **metody SaveChanges** w warstwie serwera powinny być opakowane w kod obsługi wyjątków.</span><span class="sxs-lookup"><span data-stu-id="ccc7a-153">To avoid propagating exception messages that contain sensitive data to the client tier, calls to **ApplyChanges** and **SaveChanges** on the server tier should be wrapped in exception-handling code.</span></span>  
