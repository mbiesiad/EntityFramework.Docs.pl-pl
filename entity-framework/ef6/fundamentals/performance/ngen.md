---
title: Poprawianie wydajności uruchamiania za pomocą narzędzia NGen-EF6
author: divega
ms.date: 10/23/2016
ms.assetid: dc6110a0-80a0-4370-8190-cea942841cee
ms.openlocfilehash: c9b5f8a06add9133d30955e3cc97a92e9b189bdf
ms.sourcegitcommit: 708b18520321c587b2046ad2ea9fa7c48aeebfe5
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 10/09/2019
ms.locfileid: "72182682"
---
# <a name="improving-startup-performance-with-ngen"></a><span data-ttu-id="3c8e8-102">Poprawianie wydajności uruchamiania za pomocą narzędzia NGen</span><span class="sxs-lookup"><span data-stu-id="3c8e8-102">Improving startup performance with NGen</span></span>
> [!NOTE]
> <span data-ttu-id="3c8e8-103">**Ef6 tylko** — funkcje, interfejsy API itp. omówione na tej stronie zostały wprowadzone w Entity Framework 6.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-103">**EF6 Onwards Only** - The features, APIs, etc. discussed in this page were introduced in Entity Framework 6.</span></span> <span data-ttu-id="3c8e8-104">Jeśli używasz wcześniejszej wersji, niektóre lub wszystkie informacje nie są stosowane.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-104">If you are using an earlier version, some or all of the information does not apply.</span></span>  

<span data-ttu-id="3c8e8-105">.NET Framework obsługuje generowanie obrazów natywnych dla zarządzanych aplikacji i bibliotek w celu ułatwienia uruchamiania aplikacji, a także w niektórych przypadkach użycie mniejszej ilości pamięci.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-105">The .NET Framework supports the generation of native images for managed applications and libraries as a way to help applications start faster and also in some cases use less memory.</span></span> <span data-ttu-id="3c8e8-106">Obrazy natywne są tworzone przez przetłumaczenie zestawów kodu zarządzanego do plików zawierających natywne instrukcje maszyn przed wykonaniem aplikacji, co uwalnia kompilator .NET JIT (just-in-Time) przed wygenerowaniem natywnych instrukcji w środowisko uruchomieniowe aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-106">Native images are created by translating managed code assemblies into files containing native machine instructions before the application is executed, relieving the .NET JIT (Just-In-Time) compiler from having to generate the native instructions at application runtime.</span></span>  

<span data-ttu-id="3c8e8-107">Przed wersjami 6 podstawowe biblioteki środowiska uruchomieniowego EF były częścią .NET Framework i obrazy natywne zostały automatycznie wygenerowane dla nich.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-107">Prior to version 6, the EF runtime’s core libraries were part of the .NET Framework and native images were generated automatically for them.</span></span> <span data-ttu-id="3c8e8-108">Począwszy od wersji 6, całe środowisko uruchomieniowe EF zostało połączone z pakietem NuGet EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-108">Starting with version 6 the whole EF runtime has been combined into the EntityFramework NuGet package.</span></span> <span data-ttu-id="3c8e8-109">Obrazy natywne muszą być teraz generowane przy użyciu narzędzia wiersza polecenia NGen. exe, aby uzyskać podobne wyniki.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-109">Native images have to now be generated using the NGen.exe command line tool to obtain similar results.</span></span>  

<span data-ttu-id="3c8e8-110">Obserwacje eksperymentalne pokazują, że obrazy natywne zestawów środowiska uruchomieniowego EF mogą być obcinane od 1 do 3 sekund czasu uruchamiania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-110">Empirical observations show that native images of the EF runtime assemblies can cut between 1 and 3 seconds of application startup time.</span></span>  

## <a name="how-to-use-ngenexe"></a><span data-ttu-id="3c8e8-111">Jak używać programu NGen. exe</span><span class="sxs-lookup"><span data-stu-id="3c8e8-111">How to use NGen.exe</span></span>  

<span data-ttu-id="3c8e8-112">Najbardziej podstawową funkcją narzędzia NGen. exe jest "Install" (czyli do tworzenia i utrwalania na dysku) obrazów natywnych dla zestawu i wszystkich jego bezpośrednich zależności.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-112">The most basic function of the NGen.exe tool is to “install” (that is, to create and persist to disk) native images for an assembly and all its direct dependencies.</span></span> <span data-ttu-id="3c8e8-113">Poniżej przedstawiono sposób, w jaki można to osiągnąć:</span><span class="sxs-lookup"><span data-stu-id="3c8e8-113">Here is how you can achieve that:</span></span>  

1. <span data-ttu-id="3c8e8-114">Otwórz okno wiersza polecenia jako administrator</span><span class="sxs-lookup"><span data-stu-id="3c8e8-114">Open a Command Prompt window as an administrator</span></span>  
2. <span data-ttu-id="3c8e8-115">Zmień bieżący katalog roboczy na lokalizację zestawów, dla których mają zostać wygenerowane obrazy natywne:</span><span class="sxs-lookup"><span data-stu-id="3c8e8-115">Change the current working directory to the location of the assemblies you want to generate native images for:</span></span>  

  ``` console
    cd <*Assemblies location*>  
  ```
3. <span data-ttu-id="3c8e8-116">W zależności od używanego systemu operacyjnego i konfiguracji aplikacji może być konieczne wygenerowanie obrazów natywnych dla architektury 32-bitowej o wartości 64 lub obu.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-116">Depending on your operating system and the application’s configuration you might need to generate native images for 32 bit architecture, 64 bit architecture or for both.</span></span>  

    <span data-ttu-id="3c8e8-117">W przypadku uruchomienia 32 bitowego:</span><span class="sxs-lookup"><span data-stu-id="3c8e8-117">For 32 bit run:</span></span>  
  ``` console
    %WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install <Assembly name>  
  ```
    <span data-ttu-id="3c8e8-118">W przypadku uruchomienia 64 bitowego:</span><span class="sxs-lookup"><span data-stu-id="3c8e8-118">For 64 bit run:</span></span>
  ``` console
    %WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install <Assembly name>  
  ```

> [!TIP]
> <span data-ttu-id="3c8e8-119">Generowanie obrazów natywnych dla niewłaściwej architektury jest bardzo powszechnym błędem.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-119">Generating native images for the wrong architecture is a very common mistake.</span></span> <span data-ttu-id="3c8e8-120">W razie wątpliwości można po prostu wygenerować obrazy natywne dla wszystkich architektur, które mają zastosowanie do systemu operacyjnego zainstalowanego na komputerze.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-120">When in doubt you can simply generate native images for all the architectures that apply to the operating system installed in the machine.</span></span>  

<span data-ttu-id="3c8e8-121">Program NGen. exe obsługuje również inne funkcje, takie jak Odinstalowywanie i wyświetlanie zainstalowanych obrazów natywnych, kolejkowanie generacji wielu obrazów itd. Aby uzyskać szczegółowe informacje na temat użycia, zapoznaj się z [dokumentacją Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span><span class="sxs-lookup"><span data-stu-id="3c8e8-121">NGen.exe also supports other functions such as uninstalling and displaying the installed native images, queuing the generation of multiple images, etc. For more details of usage read the [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx).</span></span>  

## <a name="when-to-use-ngenexe"></a><span data-ttu-id="3c8e8-122">Kiedy używać NGen. exe</span><span class="sxs-lookup"><span data-stu-id="3c8e8-122">When to use NGen.exe</span></span>  

<span data-ttu-id="3c8e8-123">Gdy chodzi o wybór zestawów do generowania obrazów natywnych dla aplikacji w oparciu o Dr w wersji 6 lub nowszej, należy wziąć pod uwagę następujące opcje:</span><span class="sxs-lookup"><span data-stu-id="3c8e8-123">When it comes to decide which assemblies to generate native images for in an application based on EF version 6 or greater, you should consider the following options:</span></span>  

- <span data-ttu-id="3c8e8-124">**Główny zestaw środowiska uruchomieniowego EF, EntityFramework. dll**: Typowa aplikacja oparta na EF wykonuje znaczną ilość kodu z tego zestawu podczas uruchamiania lub pierwszego dostępu do bazy danych.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-124">**The main EF runtime assembly, EntityFramework.dll**: A typical EF based application executes a significant amount of code from this assembly on startup or on its first access to the database.</span></span> <span data-ttu-id="3c8e8-125">W związku z tym tworzenie obrazów natywnych tego zestawu da największe zyski w zakresie wydajności uruchamiania.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-125">Consequently, creating native images of this assembly will produce the biggest gains in startup performance.</span></span>  
- <span data-ttu-id="3c8e8-126">**Dowolny zestaw dostawcy EF używany przez aplikację**: Czas uruchamiania może również nieco wzczerpać korzyści z generowania obrazów natywnych.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-126">**Any EF provider assembly used by your application**: Startup time can also benefit slightly from generating native images of these.</span></span> <span data-ttu-id="3c8e8-127">Na przykład jeśli aplikacja używa dostawcy EF do SQL Server należy wygenerować obraz natywny dla EntityFramework. SqlServer. dll.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-127">For example, if the application uses the EF provider for SQL Server you will want to generate a native image for EntityFramework.SqlServer.dll.</span></span>  
- <span data-ttu-id="3c8e8-128">**Zestawy aplikacji i inne zależności**: [Dokumentacja programu Ngen. exe](https://msdn.microsoft.com/library/6t9t5wcf.aspx) obejmuje ogólne kryteria wyboru zestawów do generowania obrazów natywnych oraz wpływ obrazów natywnych na zabezpieczenia, zaawansowane opcje, takie jak "twarde wiązanie", takie jak używanie obrazów natywnych w debugowaniu i scenariusze profilowania itp.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-128">**Your application’s assemblies and other dependencies**: The [NGen.exe documentation](https://msdn.microsoft.com/library/6t9t5wcf.aspx) covers general criteria for choosing which assemblies to generate native images for and the impact of native images on security, advanced options such as “hard binding”, scenarios such as using native images in debugging and profiling scenarios, etc.</span></span>  

> [!TIP]
> <span data-ttu-id="3c8e8-129">Upewnij się, że dokładnie mierzy wpływ używania obrazów natywnych na wydajność uruchamiania i ogólną wydajność aplikacji oraz porównanie ich z rzeczywistymi wymaganiami.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-129">Make sure you carefully measure the impact of using native images on both the startup performance and the overall performance of your application and compare them against actual requirements.</span></span> <span data-ttu-id="3c8e8-130">Chociaż obrazy natywne zwykle pomogą ulepszyć wydajność, a w niektórych przypadkach zmniejszają użycie pamięci, a nie wszystkie scenariusze byłyby równie korzystne.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-130">While native images will generally help improve startup up performance and in some cases reduce memory usage, not all scenarios will benefit equally.</span></span> <span data-ttu-id="3c8e8-131">Na przykład w przypadku stałego wykonywania stanu (czyli, gdy wszystkie metody używane przez aplikację zostały wywołane co najmniej raz) kod wygenerowany przez kompilator JIT może w rzeczywistości spowodować nieco lepszą wydajność niż obrazy natywne.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-131">For instance, on steady state execution (that is, once all the methods being used by the application have been invoked at least once) code generated by the JIT compiler can in fact yield slightly better performance than native images.</span></span>  

## <a name="using-ngenexe-in-a-development-machine"></a><span data-ttu-id="3c8e8-132">Korzystanie z programu NGen. exe na komputerze deweloperskim</span><span class="sxs-lookup"><span data-stu-id="3c8e8-132">Using NGen.exe in a development machine</span></span>  

<span data-ttu-id="3c8e8-133">Podczas opracowywania kompilator JIT platformy .NET oferuje najlepsze, ogólne kompromisy dla często zmieniających się kodów.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-133">During development the .NET JIT compiler will offer the best overall tradeoff for code that is changing frequently.</span></span> <span data-ttu-id="3c8e8-134">Generowanie obrazów natywnych dla skompilowanych zależności, takich jak zestawy środowiska uruchomieniowego EF, mogą pomóc przyspieszyć programowanie i testowanie poprzez wycinanie kilku sekund na początku każdego wykonania.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-134">Generating native images for compiled dependencies such as the EF runtime assemblies can help accelerate development and testing by cutting a few seconds out at the beginning of each execution.</span></span>  

<span data-ttu-id="3c8e8-135">Dobrym miejscem, aby znaleźć zestawy środowiska uruchomieniowego EF, jest lokalizacja pakietu NuGet dla rozwiązania.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-135">A good place to find the EF runtime assemblies is the NuGet package location for the solution.</span></span> <span data-ttu-id="3c8e8-136">Na przykład w przypadku aplikacji używającej EF 6.0.2 z SQL Server i przeznaczonym dla platformy .NET 4,5 lub nowszej można wpisać następujące polecenie w oknie wiersza polecenia (Pamiętaj, aby otworzyć go jako administrator):</span><span class="sxs-lookup"><span data-stu-id="3c8e8-136">For example, for an application using EF 6.0.2 with SQL Server and targeting .NET 4.5 or greater you can type the following in a Command Prompt window (remember to open it as an administrator):</span></span>  

```console
cd <Solution directory>\packages\EntityFramework.6.0.2\lib\net45
%WINDIR%\Microsoft.NET\Framework\v4.0.30319\ngen install EntityFramework.SqlServer.dll
%WINDIR%\Microsoft.NET\Framework64\v4.0.30319\ngen install EntityFramework.SqlServer.dll
```  

> [!NOTE]
> <span data-ttu-id="3c8e8-137">Pozwala to wykorzystać fakt, że zainstalowanie obrazów natywnych dla dostawcy EF dla SQL Server również domyślnie zainstaluje obrazy natywne dla głównego zestawu środowiska uruchomieniowego EF.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-137">This takes advantage of the fact that installing the native images for EF provider for SQL Server will also by default install the native images for the main EF runtime assembly.</span></span> <span data-ttu-id="3c8e8-138">Dzieje się tak, ponieważ program NGen. exe może wykryć, że EntityFramework. dll jest bezpośrednią zależnością zestawu EntityFramework. SqlServer. dll znajdującego się w tym samym katalogu.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-138">This works because NGen.exe can detect that EntityFramework.dll is a direct dependency of the EntityFramework.SqlServer.dll assembly located in the same directory.</span></span>  

## <a name="creating-native-images-during-setup"></a><span data-ttu-id="3c8e8-139">Tworzenie obrazów natywnych podczas instalacji</span><span class="sxs-lookup"><span data-stu-id="3c8e8-139">Creating native images during setup</span></span>  

<span data-ttu-id="3c8e8-140">Zestaw narzędzi WiX obsługuje Kolejkowanie obrazów natywnych dla zestawów zarządzanych podczas instalacji, zgodnie z opisem w tym [przewodniku](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span><span class="sxs-lookup"><span data-stu-id="3c8e8-140">The WiX Toolkit supports queuing the generation of native images for managed assemblies during setup, as explained in this [how-to guide](https://wixtoolset.org/documentation/manual/v3/howtos/files_and_registry/ngen_managed_assemblies.html).</span></span> <span data-ttu-id="3c8e8-141">Inną alternatywą jest utworzenie niestandardowego zadania konfiguracji, które wykonuje polecenie NGen. exe.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-141">Another alternative is to create a custom setup task that execute the NGen.exe command.</span></span>  

## <a name="verifying-that-native-images-are-being-used-for-ef"></a><span data-ttu-id="3c8e8-142">Weryfikowanie, czy obrazy natywne są używane na potrzeby EF</span><span class="sxs-lookup"><span data-stu-id="3c8e8-142">Verifying that native images are being used for EF</span></span>  

<span data-ttu-id="3c8e8-143">Możesz sprawdzić, czy określona aplikacja korzysta z zestawu natywnego, szukając załadowanych zestawów z rozszerzeniem ". ni. dll" lub ". ni. exe".</span><span class="sxs-lookup"><span data-stu-id="3c8e8-143">You can verify that a specific application is using a native assembly by looking for loaded assemblies that have the extension “.ni.dll” or “.ni.exe”.</span></span> <span data-ttu-id="3c8e8-144">Na przykład obraz macierzysty dla głównego zestawu środowiska uruchomieniowego EF będzie miał nazwę EntityFramework. ni. dll.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-144">For example, a native image for the EF’s main runtime assembly will be called EntityFramework.ni.dll.</span></span> <span data-ttu-id="3c8e8-145">Łatwym sposobem sprawdzenia załadowanych zestawów .NET procesu jest użycie [Eksploratora procesów](https://technet.microsoft.com/sysinternals/bb896653).</span><span class="sxs-lookup"><span data-stu-id="3c8e8-145">An easy way to inspect the loaded .NET assemblies of a process is to use [Process Explorer](https://technet.microsoft.com/sysinternals/bb896653).</span></span>  

## <a name="other-things-to-be-aware-of"></a><span data-ttu-id="3c8e8-146">Inne zagadnienia, z którymi należy się zapoznać</span><span class="sxs-lookup"><span data-stu-id="3c8e8-146">Other things to be aware of</span></span>  

<span data-ttu-id="3c8e8-147">**Tworzenie obrazu natywnego zestawu nie należy mylić z rejestrowaniem zestawu w [globalnej pamięci podręcznej zestawów](https://msdn.microsoft.com/library/yf1d93sz.aspx)** .</span><span class="sxs-lookup"><span data-stu-id="3c8e8-147">**Creating a native image of an assembly should not be confused with registering the assembly in the [GAC (Global Assembly Cache)](https://msdn.microsoft.com/library/yf1d93sz.aspx)**.</span></span> <span data-ttu-id="3c8e8-148">Program NGen. exe umożliwia tworzenie obrazów zestawów, które nie znajdują się w pamięci podręcznej, a w rzeczywistości wiele aplikacji, które używają określonej wersji EF, mogą współużytkować ten sam obraz macierzysty.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-148">NGen.exe allows creating images of assemblies that are not in the GAC, and in fact, multiple applications that use a specific version of EF can share the same native image.</span></span> <span data-ttu-id="3c8e8-149">System Windows 8 może automatycznie tworzyć obrazy natywne dla zestawów umieszczonych w pamięci podręcznej GAC, ale środowisko uruchomieniowe EF jest zoptymalizowane pod kątem wdrożenia wraz z aplikacją, a firma Microsoft nie zaleca rejestrowania go w pamięci podręcznej, ponieważ ma negatywny wpływ na rozdzielczość zestawu i Obsługa aplikacji między innymi aspektami.</span><span class="sxs-lookup"><span data-stu-id="3c8e8-149">While Windows 8 can automatically create native images for assemblies placed in the GAC, the EF runtime is optimized to be deployed alongside your application and we do not recommend registering it in the GAC as this has a negative impact on assembly resolution and servicing your applications among other aspects.</span></span>  
