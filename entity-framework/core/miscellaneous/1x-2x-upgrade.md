---
title: Uaktualnianie z poprzednich wersji do EF Core 2 — EF Core
author: divega
ms.date: 08/13/2017
ms.assetid: 8BD43C8C-63D9-4F3A-B954-7BC518A1B7DB
uid: core/miscellaneous/1x-2x-upgrade
ms.openlocfilehash: b27c09fdb6210dd7c6aa0c8bc912a8bd183c16b9
ms.sourcegitcommit: cc0ff36e46e9ed3527638f7208000e8521faef2e
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 03/06/2020
ms.locfileid: "78416757"
---
# <a name="upgrading-applications-from-previous-versions-to-ef-core-20"></a><span data-ttu-id="a9577-102">Uaktualnianie aplikacji z poprzednich wersji do EF Core 2,0</span><span class="sxs-lookup"><span data-stu-id="a9577-102">Upgrading applications from previous versions to EF Core 2.0</span></span>

<span data-ttu-id="a9577-103">Wprowadziliśmy okazję do znacznego zawężenia istniejących interfejsów API i zachowań w 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-103">We have taken the opportunity to significantly refine our existing APIs and behaviors in 2.0.</span></span> <span data-ttu-id="a9577-104">Istnieje kilka ulepszeń, które mogą wymagać modyfikacji istniejącego kodu aplikacji, chociaż uważamy, że w przypadku większości aplikacji wpływ będzie niski, w większości przypadków konieczna jest tylko ponowna kompilacja i minimalne zmiany z uwzględnieniem nieaktualnych interfejsów API.</span><span class="sxs-lookup"><span data-stu-id="a9577-104">There are a few improvements that can require modifying existing application code, although we believe that for the majority of applications the impact will be low, in most cases requiring just recompilation and minimal guided changes to replace obsolete APIs.</span></span>

<span data-ttu-id="a9577-105">Aktualizacja istniejącej aplikacji do EF Core 2,0 może wymagać:</span><span class="sxs-lookup"><span data-stu-id="a9577-105">Updating an existing application to EF Core 2.0 may require:</span></span>

1. <span data-ttu-id="a9577-106">Uaktualnianie docelowej implementacji platformy .NET aplikacji do jednej, która obsługuje .NET Standard 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-106">Upgrading the target .NET implementation of the application to one that supports .NET Standard 2.0.</span></span> <span data-ttu-id="a9577-107">Aby uzyskać więcej informacji, zobacz [obsługiwane implementacje platformy .NET](xref:core/platforms/index) .</span><span class="sxs-lookup"><span data-stu-id="a9577-107">See [Supported .NET Implementations](xref:core/platforms/index) for more details.</span></span>

2. <span data-ttu-id="a9577-108">Zidentyfikuj dostawcę docelowej bazy danych, która jest zgodna z EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-108">Identify a provider for the target database which is compatible with EF Core 2.0.</span></span> <span data-ttu-id="a9577-109">Zobacz [EF Core 2,0 wymaga dostawcy bazy danych 2,0](#ef-core-20-requires-a-20-database-provider) poniżej.</span><span class="sxs-lookup"><span data-stu-id="a9577-109">See [EF Core 2.0 requires a 2.0 database provider](#ef-core-20-requires-a-20-database-provider) below.</span></span>

3. <span data-ttu-id="a9577-110">Uaktualnianie wszystkich pakietów EF Core (środowisko uruchomieniowe i narzędzia) do 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-110">Upgrading all the EF Core packages (runtime and tooling) to 2.0.</span></span> <span data-ttu-id="a9577-111">Aby uzyskać więcej informacji, zobacz artykuł [instalowanie EF Core](xref:core/get-started/install/index) .</span><span class="sxs-lookup"><span data-stu-id="a9577-111">Refer to [Installing EF Core](xref:core/get-started/install/index) for more details.</span></span>

4. <span data-ttu-id="a9577-112">Wprowadź wszelkie niezbędne zmiany w kodzie, aby wyrównać zmiany, które zostały opisane w pozostałej części tego dokumentu.</span><span class="sxs-lookup"><span data-stu-id="a9577-112">Make any necessary code changes to compensate for the breaking changes described in the rest of this document.</span></span>

## <a name="aspnet-core-now-includes-ef-core"></a><span data-ttu-id="a9577-113">ASP.NET Core teraz zawiera EF Core</span><span class="sxs-lookup"><span data-stu-id="a9577-113">ASP.NET Core now includes EF Core</span></span>

<span data-ttu-id="a9577-114">Aplikacje ukierunkowane na ASP.NET Core 2,0 mogą używać EF Core 2,0 bez dodatkowych zależności poza dostawcami baz danych innych firm.</span><span class="sxs-lookup"><span data-stu-id="a9577-114">Applications targeting ASP.NET Core 2.0 can use EF Core 2.0 without additional dependencies besides third party database providers.</span></span> <span data-ttu-id="a9577-115">Jednak aplikacje zgodne z poprzednimi wersjami ASP.NET Core muszą zostać uaktualnione do ASP.NET Core 2,0, aby można było używać EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-115">However, applications targeting previous versions of ASP.NET Core need to upgrade to ASP.NET Core 2.0 in order to use EF Core 2.0.</span></span> <span data-ttu-id="a9577-116">Aby uzyskać więcej informacji na temat uaktualniania aplikacji ASP.NET Core do wersji 2,0, zobacz dokumentację dotyczącą [ASP.NET Core w temacie](/aspnet/core/migration/1x-to-2x/).</span><span class="sxs-lookup"><span data-stu-id="a9577-116">For more details on upgrading ASP.NET Core applications to 2.0 see [the ASP.NET Core documentation on the subject](/aspnet/core/migration/1x-to-2x/).</span></span>

## <a name="new-way-of-getting-application-services-in-aspnet-core"></a><span data-ttu-id="a9577-117">Nowy sposób pobierania usług aplikacji w ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="a9577-117">New way of getting application services in ASP.NET Core</span></span>

<span data-ttu-id="a9577-118">Zalecany wzorzec dla ASP.NET Core aplikacji sieci Web został zaktualizowany dla 2,0 w taki sposób, że EF Core logiki czasu projektowania używane w 1. x.</span><span class="sxs-lookup"><span data-stu-id="a9577-118">The recommended pattern for ASP.NET Core web applications has been updated for 2.0 in a way that broke the design-time logic EF Core used in 1.x.</span></span> <span data-ttu-id="a9577-119">Wcześniej w czasie projektowania EF Core próbował wywołać `Startup.ConfigureServices` bezpośrednio w celu uzyskania dostępu do dostawcy usług aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a9577-119">Previously at design-time, EF Core would try to invoke `Startup.ConfigureServices` directly in order to access the application's service provider.</span></span> <span data-ttu-id="a9577-120">W ASP.NET Core 2,0 konfiguracja jest inicjowana poza klasą `Startup`.</span><span class="sxs-lookup"><span data-stu-id="a9577-120">In ASP.NET Core 2.0, Configuration is initialized outside of the `Startup` class.</span></span> <span data-ttu-id="a9577-121">Aplikacje korzystające z EF Core zwykle uzyskują dostęp do swoich parametrów połączenia z konfiguracji, więc `Startup` przez siebie nie są już wystarczające.</span><span class="sxs-lookup"><span data-stu-id="a9577-121">Applications using EF Core typically access their connection string from Configuration, so `Startup` by itself is no longer sufficient.</span></span> <span data-ttu-id="a9577-122">W przypadku uaktualniania aplikacji ASP.NET Core 1. x podczas korzystania z narzędzi EF Core może zostać wyświetlony następujący błąd.</span><span class="sxs-lookup"><span data-stu-id="a9577-122">If you upgrade an ASP.NET Core 1.x application, you may receive the following error when using the EF Core tools.</span></span>

> <span data-ttu-id="a9577-123">Nie znaleziono konstruktora bez parametrów w "ApplicationContext".</span><span class="sxs-lookup"><span data-stu-id="a9577-123">No parameterless constructor was found on 'ApplicationContext'.</span></span> <span data-ttu-id="a9577-124">Dodaj Konstruktor bez parametrów do elementu "ApplicationContext" lub Dodaj implementację elementu "IDesignTimeDbContextFactory&lt;ApplicationContext&gt;" w tym samym zestawie co "ApplicationContext"</span><span class="sxs-lookup"><span data-stu-id="a9577-124">Either add a parameterless constructor to 'ApplicationContext' or add an implementation of 'IDesignTimeDbContextFactory&lt;ApplicationContext&gt;' in the same assembly as 'ApplicationContext'</span></span>

<span data-ttu-id="a9577-125">Nowy punkt zaczepienia czasu projektowania został dodany w domyślnym szablonie ASP.NET Core 2.0.</span><span class="sxs-lookup"><span data-stu-id="a9577-125">A new design-time hook has been added in ASP.NET Core 2.0's default template.</span></span> <span data-ttu-id="a9577-126">Metoda static `Program.BuildWebHost` umożliwia EF Core dostęp do dostawcy usług aplikacji w czasie projektowania.</span><span class="sxs-lookup"><span data-stu-id="a9577-126">The static `Program.BuildWebHost` method enables EF Core to access the application's service provider at design time.</span></span> <span data-ttu-id="a9577-127">W przypadku uaktualniania aplikacji ASP.NET Core 1. x należy zaktualizować klasę `Program`, aby była podobna do następującej.</span><span class="sxs-lookup"><span data-stu-id="a9577-127">If you are upgrading an ASP.NET Core 1.x application, you will need to update the `Program` class to resemble the following.</span></span>

``` csharp
using Microsoft.AspNetCore;
using Microsoft.AspNetCore.Hosting;

namespace AspNetCoreDotNetCore2._0App
{
    public class Program
    {
        public static void Main(string[] args)
        {
            BuildWebHost(args).Run();
        }

        public static IWebHost BuildWebHost(string[] args) =>
            WebHost.CreateDefaultBuilder(args)
                .UseStartup<Startup>()
                .Build();
    }
}
```

<span data-ttu-id="a9577-128">Przyjęcie tego nowego wzorca w przypadku aktualizowania aplikacji do 2,0 jest zdecydowanie zalecane i jest wymagane w celu zapewnienia funkcji produktu, takich jak Entity Framework Core migracji.</span><span class="sxs-lookup"><span data-stu-id="a9577-128">The adoption of this new pattern when updating applications to 2.0 is highly recommended and is required in order for product features like Entity Framework Core Migrations to work.</span></span> <span data-ttu-id="a9577-129">Inną typową alternatywą jest [implementacja *IDesignTimeDbContextFactory\<TContext >* ](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span><span class="sxs-lookup"><span data-stu-id="a9577-129">The other common alternative is to [implement *IDesignTimeDbContextFactory\<TContext>*](xref:core/miscellaneous/cli/dbcontext-creation#from-a-design-time-factory).</span></span>

## <a name="idbcontextfactory-renamed"></a><span data-ttu-id="a9577-130">IDbContextFactory zmieniono nazwę</span><span class="sxs-lookup"><span data-stu-id="a9577-130">IDbContextFactory renamed</span></span>

<span data-ttu-id="a9577-131">W celu zapewnienia obsługi różnorodnych wzorców aplikacji i zapewnienia użytkownikom większej kontroli nad sposobem korzystania z ich `DbContext` w czasie projektowania mamy w przeszłości podano interfejs `IDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="a9577-131">In order to support diverse application patterns and give users more control over how their `DbContext` is used at design time, we have, in the past, provided the `IDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="a9577-132">W czasie projektowania narzędzia EF Core będą wykrywać implementacje tego interfejsu w projekcie i używać ich do tworzenia obiektów `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="a9577-132">At design-time, the EF Core tools will discover implementations of this interface in your project and use it to create `DbContext` objects.</span></span>

<span data-ttu-id="a9577-133">Ten interfejs miał bardzo ogólną nazwę, która wprowadza niektórym użytkownikom próbę ponownego użycia dla innych scenariuszy tworzenia `DbContext`.</span><span class="sxs-lookup"><span data-stu-id="a9577-133">This interface had a very general name which mislead some users to try re-using it for other `DbContext`-creating scenarios.</span></span> <span data-ttu-id="a9577-134">Zostały one przechwycone, gdy narzędzia EF próbują użyć ich implementacji w czasie projektowania i powodowały niepowodzenie poleceń takich jak `Update-Database` lub `dotnet ef database update`.</span><span class="sxs-lookup"><span data-stu-id="a9577-134">They were caught off guard when the EF Tools then tried to use their implementation at design-time and caused commands like `Update-Database` or `dotnet ef database update` to fail.</span></span>

<span data-ttu-id="a9577-135">Aby można było przekazać silną semantykę czasu projektowania tego interfejsu, zmieniono jego nazwę na `IDesignTimeDbContextFactory<TContext>`.</span><span class="sxs-lookup"><span data-stu-id="a9577-135">In order to communicate the strong design-time semantics of this interface, we have renamed it to `IDesignTimeDbContextFactory<TContext>`.</span></span>

<span data-ttu-id="a9577-136">W przypadku wersji 2,0 `IDbContextFactory<TContext>` nadal istnieje, ale jest oznaczony jako przestarzały.</span><span class="sxs-lookup"><span data-stu-id="a9577-136">For the 2.0 release the `IDbContextFactory<TContext>` still exists but is marked as obsolete.</span></span>

## <a name="dbcontextfactoryoptions-removed"></a><span data-ttu-id="a9577-137">DbContextFactoryOptions usunięte</span><span class="sxs-lookup"><span data-stu-id="a9577-137">DbContextFactoryOptions removed</span></span>

<span data-ttu-id="a9577-138">Ze względu na opisane powyżej ASP.NET Core 2,0 zmiany w nowym interfejsie `IDesignTimeDbContextFactory<TContext>` nie `DbContextFactoryOptions` już potrzebne.</span><span class="sxs-lookup"><span data-stu-id="a9577-138">Because of the ASP.NET Core 2.0 changes described above, we found that `DbContextFactoryOptions` was no longer needed on the new `IDesignTimeDbContextFactory<TContext>` interface.</span></span> <span data-ttu-id="a9577-139">Poniżej znajdują się alternatywy, których należy użyć zamiast tego.</span><span class="sxs-lookup"><span data-stu-id="a9577-139">Here are the alternatives you should be using instead.</span></span>

| <span data-ttu-id="a9577-140">DbContextFactoryOptions</span><span class="sxs-lookup"><span data-stu-id="a9577-140">DbContextFactoryOptions</span></span> | <span data-ttu-id="a9577-141">Różne</span><span class="sxs-lookup"><span data-stu-id="a9577-141">Alternative</span></span>                                                  |
|:------------------------|:-------------------------------------------------------------|
| <span data-ttu-id="a9577-142">ApplicationBasePath</span><span class="sxs-lookup"><span data-stu-id="a9577-142">ApplicationBasePath</span></span>     | <span data-ttu-id="a9577-143">AppContext.BaseDirectory</span><span class="sxs-lookup"><span data-stu-id="a9577-143">AppContext.BaseDirectory</span></span>                                     |
| <span data-ttu-id="a9577-144">ContentRootPath</span><span class="sxs-lookup"><span data-stu-id="a9577-144">ContentRootPath</span></span>         | <span data-ttu-id="a9577-145">Directory.GetCurrentDirectory()</span><span class="sxs-lookup"><span data-stu-id="a9577-145">Directory.GetCurrentDirectory()</span></span>                              |
| <span data-ttu-id="a9577-146">EnvironmentName</span><span class="sxs-lookup"><span data-stu-id="a9577-146">EnvironmentName</span></span>         | <span data-ttu-id="a9577-147">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span><span class="sxs-lookup"><span data-stu-id="a9577-147">Environment.GetEnvironmentVariable("ASPNETCORE_ENVIRONMENT")</span></span> |

## <a name="design-time-working-directory-changed"></a><span data-ttu-id="a9577-148">Katalog roboczy czasu projektowania został zmieniony</span><span class="sxs-lookup"><span data-stu-id="a9577-148">Design-time working directory changed</span></span>

<span data-ttu-id="a9577-149">Zmiany ASP.NET Core 2,0 także wymagały katalogu roboczego używanego przez `dotnet ef` do wyrównania z katalogiem roboczym używanym przez program Visual Studio podczas uruchamiania aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a9577-149">The ASP.NET Core 2.0 changes also required the working directory used by `dotnet ef` to align with the working directory used by Visual Studio when running your application.</span></span> <span data-ttu-id="a9577-150">Jednym z zauważalnych efektów ubocznych tego jest to, że nazwy plików oprogramowania SQLite są teraz względne dla katalogu projektu, a nie do katalogu wyjściowego, tak jak w przypadku programu.</span><span class="sxs-lookup"><span data-stu-id="a9577-150">One observable side effect of this is that SQLite filenames are now relative to the project directory and not the output directory like they used to be.</span></span>

## <a name="ef-core-20-requires-a-20-database-provider"></a><span data-ttu-id="a9577-151">EF Core 2,0 wymaga dostawcy bazy danych 2,0</span><span class="sxs-lookup"><span data-stu-id="a9577-151">EF Core 2.0 requires a 2.0 database provider</span></span>

<span data-ttu-id="a9577-152">W przypadku EF Core 2,0 wprowadziliśmy wiele uproszczeń i ulepszeń w sposobie działania dostawców baz danych.</span><span class="sxs-lookup"><span data-stu-id="a9577-152">For EF Core 2.0 we have made many simplifications and improvements in the way database providers work.</span></span> <span data-ttu-id="a9577-153">Oznacza to, że dostawcy 1.0. x i 1.1. x nie będą współpracować z EF Core 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-153">This means that 1.0.x and 1.1.x providers will not work with EF Core 2.0.</span></span>

<span data-ttu-id="a9577-154">Dostawcy usług SQL Server i SQLite są dostarczani przez zespół EF i wersje 2,0 będą dostępne w ramach wersji 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-154">The SQL Server and SQLite providers are shipped by the EF team and 2.0 versions will be available as part of the 2.0 release.</span></span> <span data-ttu-id="a9577-155">Dostawcy Open-Source innych firm dla [programu SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL)i [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) są aktualizowane dla 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-155">The open-source third party providers for [SQL Compact](https://github.com/ErikEJ/EntityFramework.SqlServerCompact), [PostgreSQL](https://github.com/npgsql/Npgsql.EntityFrameworkCore.PostgreSQL), and [MySQL](https://github.com/PomeloFoundation/Pomelo.EntityFrameworkCore.MySql) are being updated for 2.0.</span></span> <span data-ttu-id="a9577-156">W przypadku wszystkich innych dostawców skontaktuj się z modułem zapisującym dostawcy.</span><span class="sxs-lookup"><span data-stu-id="a9577-156">For all other providers, please contact the provider writer.</span></span>

## <a name="logging-and-diagnostics-events-have-changed"></a><span data-ttu-id="a9577-157">Zdarzenia rejestrowania i diagnostyki zostały zmienione</span><span class="sxs-lookup"><span data-stu-id="a9577-157">Logging and Diagnostics events have changed</span></span>

<span data-ttu-id="a9577-158">Uwaga: te zmiany nie powinny mieć wpływu na większość kodu aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a9577-158">Note: these changes should not impact most application code.</span></span>

<span data-ttu-id="a9577-159">Identyfikatory zdarzeń dla komunikatów wysyłanych do [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) uległy zmianie w 2,0.</span><span class="sxs-lookup"><span data-stu-id="a9577-159">The event IDs for messages sent to an [ILogger](/dotnet/api/microsoft.extensions.logging.ilogger) have changed in 2.0.</span></span> <span data-ttu-id="a9577-160">Identyfikatory zdarzeń są teraz unikatowe w EF Core kodzie.</span><span class="sxs-lookup"><span data-stu-id="a9577-160">The event IDs are now unique across EF Core code.</span></span> <span data-ttu-id="a9577-161">Te komunikaty są teraz zgodne ze standardowym wzorcem rejestrowania strukturalnego używanego przez program, na przykład MVC.</span><span class="sxs-lookup"><span data-stu-id="a9577-161">These messages now also follow the standard pattern for structured logging used by, for example, MVC.</span></span>

<span data-ttu-id="a9577-162">Zmieniono także kategorie rejestratora.</span><span class="sxs-lookup"><span data-stu-id="a9577-162">Logger categories have also changed.</span></span> <span data-ttu-id="a9577-163">Istnieje teraz dobrze znany zestaw kategorii, do których można uzyskać dostęp za pomocą [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span><span class="sxs-lookup"><span data-stu-id="a9577-163">There is now a well-known set of categories accessed through [DbLoggerCategory](https://github.com/aspnet/EntityFrameworkCore/blob/rel/2.0.0/src/EFCore/DbLoggerCategory.cs).</span></span>

<span data-ttu-id="a9577-164">Zdarzenia [DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) teraz używają tych samych nazw identyfikatorów zdarzeń co odpowiadające im komunikaty `ILogger`.</span><span class="sxs-lookup"><span data-stu-id="a9577-164">[DiagnosticSource](https://github.com/dotnet/corefx/blob/master/src/System.Diagnostics.DiagnosticSource/src/DiagnosticSourceUsersGuide.md) events now use the same event ID names as the corresponding `ILogger` messages.</span></span> <span data-ttu-id="a9577-165">Ładunki zdarzeń to wszystkie typy nominalne pochodne od [EVENTDATA](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span><span class="sxs-lookup"><span data-stu-id="a9577-165">The event payloads are all nominal types derived from [EventData](/dotnet/api/microsoft.entityframeworkcore.diagnostics.eventdata).</span></span>

<span data-ttu-id="a9577-166">Identyfikatory zdarzeń, typy ładunku i kategorie są udokumentowane w klasach [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) i [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) .</span><span class="sxs-lookup"><span data-stu-id="a9577-166">Event IDs, payload types, and categories are documented in the [CoreEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.coreeventid) and the [RelationalEventId](/dotnet/api/microsoft.entityframeworkcore.diagnostics.relationaleventid) classes.</span></span>

<span data-ttu-id="a9577-167">Identyfikatory zostały również przeniesione z Microsoft. EntityFrameworkCore. Infrastructure do nowej przestrzeni nazw Microsoft. EntityFrameworkCore. Diagnostics.</span><span class="sxs-lookup"><span data-stu-id="a9577-167">IDs have also moved from Microsoft.EntityFrameworkCore.Infrastructure to the new Microsoft.EntityFrameworkCore.Diagnostics namespace.</span></span>

## <a name="ef-core-relational-metadata-api-changes"></a><span data-ttu-id="a9577-168">EF Core zmiany relacyjnego interfejsu API metadanych</span><span class="sxs-lookup"><span data-stu-id="a9577-168">EF Core relational metadata API changes</span></span>

<span data-ttu-id="a9577-169">EF Core 2,0 będzie teraz kompilować inne [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) dla każdego używanego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="a9577-169">EF Core 2.0 will now build a different [IModel](/dotnet/api/microsoft.entityframeworkcore.metadata.imodel) for each different provider being used.</span></span> <span data-ttu-id="a9577-170">Jest to zazwyczaj przezroczyste dla aplikacji.</span><span class="sxs-lookup"><span data-stu-id="a9577-170">This is usually transparent to the application.</span></span> <span data-ttu-id="a9577-171">Ułatwia to uproszczenie interfejsów API metadanych niższego poziomu, takich jak każdy dostęp do _wspólnych koncepcji metadanych relacyjnych_ jest zawsze realizowany przez wywołanie `.Relational` zamiast `.SqlServer`, `.Sqlite`itd. Na przykład kod 1.1. x podobny do tego:</span><span class="sxs-lookup"><span data-stu-id="a9577-171">This has facilitated a simplification of lower-level metadata APIs such that any access to _common relational metadata concepts_ is always made through a call to `.Relational` instead of `.SqlServer`, `.Sqlite`, etc. For example, 1.1.x code like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).SqlServer().TableName;
```

<span data-ttu-id="a9577-172">Powinien zostać teraz zapisany w następujący sposób:</span><span class="sxs-lookup"><span data-stu-id="a9577-172">Should now be written like this:</span></span>

``` csharp
var tableName = context.Model.FindEntityType(typeof(User)).Relational().TableName;
```

<span data-ttu-id="a9577-173">Zamiast korzystać z metod takich jak `ForSqlServerToTable`, metody rozszerzające są teraz dostępne do pisania kodu warunkowego na podstawie bieżącego dostawcy w użyciu.</span><span class="sxs-lookup"><span data-stu-id="a9577-173">Instead of using methods like `ForSqlServerToTable`, extension methods are now available to write conditional code based on the current provider in use.</span></span> <span data-ttu-id="a9577-174">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="a9577-174">For example:</span></span>

```csharp
modelBuilder.Entity<User>().ToTable(
    Database.IsSqlServer() ? "SqlServerName" : "OtherName");
```

<span data-ttu-id="a9577-175">Należy zauważyć, że ta zmiana dotyczy tylko interfejsów API/metadanych, które są zdefiniowane dla _wszystkich_ dostawców relacyjnych.</span><span class="sxs-lookup"><span data-stu-id="a9577-175">Note that this change only applies to APIs/metadata that is defined for _all_ relational providers.</span></span> <span data-ttu-id="a9577-176">Interfejs API i metadane pozostają takie same, jeśli są specyficzne tylko dla jednego dostawcy.</span><span class="sxs-lookup"><span data-stu-id="a9577-176">The API and metadata remains the same when it is specific to only a single provider.</span></span> <span data-ttu-id="a9577-177">Na przykład indeksy klastrowane są specyficzne dla programu SQL Server, więc `ForSqlServerIsClustered` i `.SqlServer().IsClustered()` nadal muszą być używane.</span><span class="sxs-lookup"><span data-stu-id="a9577-177">For example, clustered indexes are specific to SQL Sever, so `ForSqlServerIsClustered` and  `.SqlServer().IsClustered()` must still be used.</span></span>

## <a name="dont-take-control-of-the-ef-service-provider"></a><span data-ttu-id="a9577-178">Nie Przejmij kontroli nad dostawcą usług EF</span><span class="sxs-lookup"><span data-stu-id="a9577-178">Don’t take control of the EF service provider</span></span>

<span data-ttu-id="a9577-179">EF Core używa wewnętrznego `IServiceProvider` (kontenera iniekcji zależności) dla jego wewnętrznej implementacji.</span><span class="sxs-lookup"><span data-stu-id="a9577-179">EF Core uses an internal `IServiceProvider` (a dependency injection container) for its internal implementation.</span></span> <span data-ttu-id="a9577-180">Aplikacje powinny zezwalać EF Core na tworzenie tego dostawcy i zarządzanie nim, z wyjątkiem przypadków specjalnych.</span><span class="sxs-lookup"><span data-stu-id="a9577-180">Applications should allow EF Core to create and manage this provider except in special cases.</span></span> <span data-ttu-id="a9577-181">Zdecydowanie należy rozważyć usunięcie wszelkich wywołań do `UseInternalServiceProvider`.</span><span class="sxs-lookup"><span data-stu-id="a9577-181">Strongly consider removing any calls to `UseInternalServiceProvider`.</span></span> <span data-ttu-id="a9577-182">Jeśli aplikacja wymaga wywołania `UseInternalServiceProvider`, należy rozważyć [zgłoszenie problemu](https://github.com/aspnet/EntityFramework/Issues) , aby można było zbadać inne sposoby obsługi Twojego scenariusza.</span><span class="sxs-lookup"><span data-stu-id="a9577-182">If an application does need to call `UseInternalServiceProvider`, then please consider [filing an issue](https://github.com/aspnet/EntityFramework/Issues) so we can investigate other ways to handle your scenario.</span></span>

<span data-ttu-id="a9577-183">Wywoływanie `AddEntityFramework`, `AddEntityFrameworkSqlServer`itp. nie jest wymagane przez kod aplikacji, chyba że `UseInternalServiceProvider` jest również wywoływana.</span><span class="sxs-lookup"><span data-stu-id="a9577-183">Calling `AddEntityFramework`, `AddEntityFrameworkSqlServer`, etc. is not required by application code unless `UseInternalServiceProvider` is also called.</span></span> <span data-ttu-id="a9577-184">Usuń wszystkie istniejące wywołania do `AddEntityFramework` lub `AddEntityFrameworkSqlServer`itp. `AddDbContext` nadal powinny być używane w taki sam sposób jak wcześniej.</span><span class="sxs-lookup"><span data-stu-id="a9577-184">Remove any existing calls to `AddEntityFramework` or `AddEntityFrameworkSqlServer`, etc. `AddDbContext` should still be used in the same way as before.</span></span>

## <a name="in-memory-databases-must-be-named"></a><span data-ttu-id="a9577-185">Bazy danych w pamięci muszą mieć nazwę</span><span class="sxs-lookup"><span data-stu-id="a9577-185">In-memory databases must be named</span></span>

<span data-ttu-id="a9577-186">Globalna nienazwana baza danych w pamięci została usunięta, a w zamian wszystkie bazy danych w pamięci muszą mieć nazwę.</span><span class="sxs-lookup"><span data-stu-id="a9577-186">The global unnamed in-memory database has been removed and instead all in-memory databases must be named.</span></span> <span data-ttu-id="a9577-187">Na przykład:</span><span class="sxs-lookup"><span data-stu-id="a9577-187">For example:</span></span>

``` csharp
optionsBuilder.UseInMemoryDatabase("MyDatabase");
```

<span data-ttu-id="a9577-188">Spowoduje to utworzenie/użycie bazy danych o nazwie "Moja baza danych".</span><span class="sxs-lookup"><span data-stu-id="a9577-188">This creates/uses a database with the name “MyDatabase”.</span></span> <span data-ttu-id="a9577-189">Jeśli `UseInMemoryDatabase` jest ponownie wywoływana o tej samej nazwie, zostanie użyta taka sama baza danych w pamięci, która będzie mogła być współużytkowana przez wiele wystąpień kontekstu.</span><span class="sxs-lookup"><span data-stu-id="a9577-189">If `UseInMemoryDatabase` is called again with the same name, then the same in-memory database will be used, allowing it to be shared by multiple context instances.</span></span>

## <a name="read-only-api-changes"></a><span data-ttu-id="a9577-190">Zmiany w interfejsie API tylko do odczytu</span><span class="sxs-lookup"><span data-stu-id="a9577-190">Read-only API changes</span></span>

<span data-ttu-id="a9577-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`i `IsStoreGeneratedAlways` zostały przestarzałe i zastąpione atrybutami [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) i [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span><span class="sxs-lookup"><span data-stu-id="a9577-191">`IsReadOnlyBeforeSave`, `IsReadOnlyAfterSave`, and `IsStoreGeneratedAlways` have been obsoleted and replaced with [BeforeSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.beforesavebehavior) and [AfterSaveBehavior](/dotnet/api/microsoft.entityframeworkcore.metadata.iproperty.aftersavebehavior).</span></span> <span data-ttu-id="a9577-192">Te zachowania mają zastosowanie do dowolnej właściwości (nie tylko właściwości generowane przez magazyn) i określają, w jaki sposób wartość właściwości ma być używana podczas wstawiania do wiersza bazy danych (`BeforeSaveBehavior`) lub podczas aktualizowania istniejącego wiersza bazy danych (`AfterSaveBehavior`).</span><span class="sxs-lookup"><span data-stu-id="a9577-192">These behaviors apply to any property (not only store-generated properties) and determine how the value of the property should be used when inserting into a database row (`BeforeSaveBehavior`) or when updating an existing database row (`AfterSaveBehavior`).</span></span>

<span data-ttu-id="a9577-193">Właściwości oznaczone jako [ValueGenerated. OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (na przykład w przypadku kolumn obliczanych) domyślnie ignorują każdą wartość ustawioną obecnie we właściwości.</span><span class="sxs-lookup"><span data-stu-id="a9577-193">Properties marked as [ValueGenerated.OnAddOrUpdate](/dotnet/api/microsoft.entityframeworkcore.metadata.valuegenerated) (for example, for computed columns) will by default ignore any value currently set on the property.</span></span> <span data-ttu-id="a9577-194">Oznacza to, że wygenerowana przez magazyn wartość zawsze zostanie uzyskana niezależnie od tego, czy dla śledzonej jednostki została ustawiona lub zmodyfikowana wartość.</span><span class="sxs-lookup"><span data-stu-id="a9577-194">This means that a store-generated value will always be obtained regardless of whether any value has been set or modified on the tracked entity.</span></span> <span data-ttu-id="a9577-195">Można to zmienić, ustawiając inną `Before\AfterSaveBehavior`.</span><span class="sxs-lookup"><span data-stu-id="a9577-195">This can be changed by setting a different `Before\AfterSaveBehavior`.</span></span>

## <a name="new-clientsetnull-delete-behavior"></a><span data-ttu-id="a9577-196">Nowe zachowanie dotyczące usuwania ClientSetNull</span><span class="sxs-lookup"><span data-stu-id="a9577-196">New ClientSetNull delete behavior</span></span>

<span data-ttu-id="a9577-197">W poprzednich wersjach [DeleteBehavior. ograniczał](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) zachowanie dla jednostek śledzonych przez kontekst, który został jeszcze zamknięty, `SetNull` semantyki.</span><span class="sxs-lookup"><span data-stu-id="a9577-197">In previous releases, [DeleteBehavior.Restrict](/dotnet/api/microsoft.entityframeworkcore.deletebehavior) had a behavior for entities tracked by the context that more closed matched `SetNull` semantics.</span></span> <span data-ttu-id="a9577-198">W EF Core 2,0 wprowadzono nowe zachowanie `ClientSetNull` jako domyślne dla relacji opcjonalnych.</span><span class="sxs-lookup"><span data-stu-id="a9577-198">In EF Core 2.0, a new `ClientSetNull` behavior has been introduced as the default for optional relationships.</span></span> <span data-ttu-id="a9577-199">To zachowanie ma `SetNull` semantyką dla śledzonych jednostek i zachowania `Restrict` dla baz danych utworzonych przy użyciu EF Core.</span><span class="sxs-lookup"><span data-stu-id="a9577-199">This behavior has `SetNull` semantics for tracked entities and `Restrict` behavior for databases created using EF Core.</span></span> <span data-ttu-id="a9577-200">W naszym środowisku są to najbardziej oczekiwane/przydatne zachowania dla śledzonych jednostek i bazy danych.</span><span class="sxs-lookup"><span data-stu-id="a9577-200">In our experience, these are the most expected/useful behaviors for tracked entities and the database.</span></span> <span data-ttu-id="a9577-201">`DeleteBehavior.Restrict` jest teraz uznawany za śledzone jednostki, gdy ustawiono dla relacji opcjonalnych.</span><span class="sxs-lookup"><span data-stu-id="a9577-201">`DeleteBehavior.Restrict` is now honored for tracked entities when set for optional relationships.</span></span>

## <a name="provider-design-time-packages-removed"></a><span data-ttu-id="a9577-202">Usunięto pakiety czasu projektowania dostawcy</span><span class="sxs-lookup"><span data-stu-id="a9577-202">Provider design-time packages removed</span></span>

<span data-ttu-id="a9577-203">Pakiet `Microsoft.EntityFrameworkCore.Relational.Design` został usunięty.</span><span class="sxs-lookup"><span data-stu-id="a9577-203">The `Microsoft.EntityFrameworkCore.Relational.Design` package has been removed.</span></span> <span data-ttu-id="a9577-204">Zawartość została skonsolidowana w `Microsoft.EntityFrameworkCore.Relational` i `Microsoft.EntityFrameworkCore.Design`.</span><span class="sxs-lookup"><span data-stu-id="a9577-204">It's contents were consolidated into `Microsoft.EntityFrameworkCore.Relational` and `Microsoft.EntityFrameworkCore.Design`.</span></span>

<span data-ttu-id="a9577-205">To propaguje do pakietów czasu projektowania dostawcy.</span><span class="sxs-lookup"><span data-stu-id="a9577-205">This propagates into the provider design-time packages.</span></span> <span data-ttu-id="a9577-206">Te pakiety (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`itp.) zostały usunięte i ich zawartość jest konsolidowana do głównych pakietów dostawcy.</span><span class="sxs-lookup"><span data-stu-id="a9577-206">Those packages (`Microsoft.EntityFrameworkCore.Sqlite.Design`, `Microsoft.EntityFrameworkCore.SqlServer.Design`, etc.) were removed and their contents consolidated into the main provider packages.</span></span>

<span data-ttu-id="a9577-207">Aby włączyć `Scaffold-DbContext` lub `dotnet ef dbcontext scaffold` w EF Core 2,0, należy odwołać się tylko do pojedynczego pakietu dostawcy:</span><span class="sxs-lookup"><span data-stu-id="a9577-207">To enable `Scaffold-DbContext` or `dotnet ef dbcontext scaffold` in EF Core 2.0, you only need to reference the single provider package:</span></span>

``` xml
<PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer"
    Version="2.0.0" />
<PackageReference Include="Microsoft.EntityFrameworkCore.Tools"
    Version="2.0.0"
    PrivateAssets="All" />
<DotNetCliToolReference Include="Microsoft.EntityFrameworkCore.Tools.DotNet"
    Version="2.0.0" />
```
