---
title: Sortowanie i czułość wielkości liter — EF Core
description: Jak skonfigurować sortowanie i uwzględnianie wielkości liter w bazie danych i zapytaniach
author: roji
ms.date: 04/27/2020
ms.assetid: bde4e0ee-fba3-4813-a849-27049323d301
uid: core/miscellaneous/collations-and-case-sensitivity
ms.openlocfilehash: b3874847922cb39aa57d50813e6e50ff7db72eb9
ms.sourcegitcommit: ebfd3382fc583bc90f0da58e63d6e3382b30aa22
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 06/25/2020
ms.locfileid: "85370568"
---
# <a name="collations-and-case-sensitivity"></a><span data-ttu-id="59105-103">Sortowanie i rozróżnianie wielkości liter</span><span class="sxs-lookup"><span data-stu-id="59105-103">Collations and Case Sensitivity</span></span>

> [!NOTE]
> <span data-ttu-id="59105-104">Ta funkcja jest wprowadzana w EF Core 5,0.</span><span class="sxs-lookup"><span data-stu-id="59105-104">This feature is introduced in EF Core 5.0.</span></span>

<span data-ttu-id="59105-105">Przetwarzanie tekstu w bazach danych może być złożone i wymaga większej uwagi użytkownika, że jedna z nich będzie podejrzana.</span><span class="sxs-lookup"><span data-stu-id="59105-105">Text processing in databases can be a complex, and requires more user attention that one would suspect.</span></span> <span data-ttu-id="59105-106">W jednym z baz danych różnią się w zależności od sposobu obsługi tekstu; na przykład w przypadku niektórych baz danych domyślnie uwzględniana jest wielkość liter (np. SQLite, PostgreSQL), inne nie uwzględniają wielkości liter (SQL Server, MySQL).</span><span class="sxs-lookup"><span data-stu-id="59105-106">For one thing, databases vary considerably in how they handle text; for example, while some databases are case-sensitive by default (e.g. Sqlite, PostgreSQL), others are case-insensitive (SQL Server, MySQL).</span></span> <span data-ttu-id="59105-107">Ponadto ze względu na użycie indeksu, uwzględnianie wielkości liter i podobne aspekty mogą mieć znacznie idący wpływ na wydajność zapytań: Chociaż może być skłonny do użycia w `string.Lower` celu wymuszenia porównania bez uwzględniania wielkości liter w bazie danych z uwzględnieniem wielkości liter, może to uniemożliwić aplikacji używanie indeksów.</span><span class="sxs-lookup"><span data-stu-id="59105-107">In addition, because of index usage, case-sensitivity and similar aspects can have a far-reaching impact on query performance: while it may be tempting to use `string.Lower` to force a case-insensitive comparison in a case-sensitive database, doing so may prevent your application from using indexes.</span></span> <span data-ttu-id="59105-108">Ta strona zawiera szczegółowe informacje dotyczące konfigurowania uwzględniania wielkości liter lub bardziej ogólnych, sortowanych i sposobu wykonywania tych czynności w skuteczny sposób bez naruszania wydajności zapytań.</span><span class="sxs-lookup"><span data-stu-id="59105-108">This page details how to configure case sensitivity, or more generally, collations, and how to do so in an efficient way without compromising query performance.</span></span>

## <a name="introduction-to-collations"></a><span data-ttu-id="59105-109">Wprowadzenie do sortowania</span><span class="sxs-lookup"><span data-stu-id="59105-109">Introduction to collations</span></span>

<span data-ttu-id="59105-110">Podstawową koncepcją przetwarzania tekstu jest *Sortowanie*, które jest zestawem reguł określających, w jaki sposób wartości tekstowe są uporządkowane i porównywane pod kątem równości.</span><span class="sxs-lookup"><span data-stu-id="59105-110">A fundamental concept in text processing is the *collation*, which is a set of rules determining how text values are ordered and compared for equality.</span></span> <span data-ttu-id="59105-111">Na przykład, podczas sortowania bez uwzględniania wielkości liter nie są rozróżniane wielkie i małe litery dla celów porównania równości, sortowanie uwzględniające wielkość liter nie jest dozwolone.</span><span class="sxs-lookup"><span data-stu-id="59105-111">For example, while a case-insensitive collation disregards differences between upper- and lower-case letters for the purposes of equality comparison, a case-sensitive collation does not.</span></span> <span data-ttu-id="59105-112">Jednak ze względu na wielkość liter jest rozróżniana kulturami (np. `i` `I` reprezentuje różne litery w turecki), istnieje wiele nierozróżniających wielkości liter sortowanie, z których każdy ma własny zestaw reguł.</span><span class="sxs-lookup"><span data-stu-id="59105-112">However, since case-sensitivity is culture-sensitive (e.g. `i` and `I` represent different letter in Turkish), there exist multiple case-insensitive collations, each with its own set of rules.</span></span> <span data-ttu-id="59105-113">Zakres sortowania jest również rozciągany poza wielkość liter, do innych aspektów danych znakowych; na przykład w języku niemieckim jest to czasami (ale nie zawsze) pożądane do traktowania `ä` i `ae` tak samo.</span><span class="sxs-lookup"><span data-stu-id="59105-113">The scope of collations also extends beyond case-sensitivity, to other aspects of character data; in German, for example, it is sometimes (but not always) desirable to treat `ä` and `ae` as identical.</span></span> <span data-ttu-id="59105-114">Ponadto sortowania definiują sposób *uporządkowania*wartości tekstowych: w przypadku niemieckich miejsc `ä` po `a` , szwedzki umieszcza je na końcu alfabetu.</span><span class="sxs-lookup"><span data-stu-id="59105-114">Finally, collations also define how text values are *ordered*: while German places `ä` after `a`, Swedish places it at the end of the alphabet.</span></span>

<span data-ttu-id="59105-115">Wszystkie operacje tekstowe w bazie danych używają sortowania — określa, czy jawnie lub niejawnie — aby określić, w jaki sposób operacja porównuje i porządkuje ciągi.</span><span class="sxs-lookup"><span data-stu-id="59105-115">All text operations in a database use a collation - whether explicitly or implicitly - to determine how the operation compares and orders strings.</span></span> <span data-ttu-id="59105-116">Rzeczywista lista dostępnych ustawień sortowania i ich schemat nazewnictwa jest specyficzna dla bazy danych; Zapoznaj się [z sekcją poniżej,](#database-specific-information) Aby uzyskać łącza do odpowiednich stron dokumentacji różnych baz danych.</span><span class="sxs-lookup"><span data-stu-id="59105-116">The actual list of available collations and their naming schemes is database-specific; consult [the section below](#database-specific-information) for links to relevant documentation pages of various databases.</span></span> <span data-ttu-id="59105-117">Na szczęście baza danych zwykle zezwala na Definiowanie sortowania domyślnego na poziomie bazy danych lub kolumny oraz jawnie określać sortowanie, które ma być używane dla określonych operacji w zapytaniu.</span><span class="sxs-lookup"><span data-stu-id="59105-117">Fortunately, database do generally allow a default collation to be defined at the database or column level, and to explicitly specify which collation should be use for specific operations in a query.</span></span>

## <a name="database-collation"></a><span data-ttu-id="59105-118">Sortowanie bazy danych</span><span class="sxs-lookup"><span data-stu-id="59105-118">Database collation</span></span>

<span data-ttu-id="59105-119">W większości systemów baz danych sortowanie domyślne jest definiowane na poziomie bazy danych; Jeśli nie zostanie zastąpione, sortowanie niejawnie stosuje się do wszystkich operacji tekstowych występujących w tej bazie danych.</span><span class="sxs-lookup"><span data-stu-id="59105-119">In most database systems, a default collation is defined at the database level; unless overridden, that collation implicitly applies to all text operations occurring within that database.</span></span> <span data-ttu-id="59105-120">Sortowanie bazy danych jest zazwyczaj ustawiane podczas tworzenia bazy danych (za pośrednictwem `CREATE DATABASE` instrukcji DDL), a jeśli nie zostanie określony, wartością domyślną jest niektóre wartości na poziomie serwera, które są określane podczas instalacji.</span><span class="sxs-lookup"><span data-stu-id="59105-120">The database collation is typically set at database creation time (via the `CREATE DATABASE` DDL statement), and if not specified, defaults to a some server-level value determined at setup time.</span></span> <span data-ttu-id="59105-121">Na przykład domyślne sortowanie na poziomie serwera w SQL Server to, w `SQL_Latin1_General_CP1_CI_AS` którym jest rozróżniana wielkość liter, sortowanie z uwzględnieniem akcentów.</span><span class="sxs-lookup"><span data-stu-id="59105-121">For example, the default server-level collation in SQL Server is `SQL_Latin1_General_CP1_CI_AS`, which is a case-insensitive, accent-sensitive collation.</span></span> <span data-ttu-id="59105-122">Mimo że systemy baz danych zwykle umożliwiają zmianę sortowania istniejącej bazy danych, może to prowadzić do komplikacji; zaleca się wybranie sortowania przed utworzeniem bazy danych.</span><span class="sxs-lookup"><span data-stu-id="59105-122">Although database systems usually do permit altering the collation of an existing database, doing so can lead to complications; it is recommended to pick a collation before database creation.</span></span>

<span data-ttu-id="59105-123">W przypadku korzystania z EF Core migracji w celu zarządzania schematem bazy danych następujące metody modelu umożliwiają `OnModelCreating` skonfigurowanie SQL Serverj bazy danych do używania sortowania z uwzględnieniem wielkości liter:</span><span class="sxs-lookup"><span data-stu-id="59105-123">When using EF Core migrations to manage your database schema, the following in your model's `OnModelCreating` method configures a SQL Server database to use a case-sensitive collation:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?range=40)]

## <a name="column-collation"></a><span data-ttu-id="59105-124">Sortowanie kolumn</span><span class="sxs-lookup"><span data-stu-id="59105-124">Column collation</span></span>

<span data-ttu-id="59105-125">Sortowanie można także definiować w kolumnach tekstowych, zastępując domyślną bazę danych.</span><span class="sxs-lookup"><span data-stu-id="59105-125">Collations can also be defined on text columns, overriding the database default.</span></span> <span data-ttu-id="59105-126">Może to być przydatne, jeśli niektóre kolumny muszą mieć wielkość liter, podczas gdy pozostała część bazy danych wymaga uwzględnienia wielkości liter.</span><span class="sxs-lookup"><span data-stu-id="59105-126">This can be useful if certain columns need to be case-insensitive, while the rest of the database needs to be case-sensitive.</span></span>

<span data-ttu-id="59105-127">W przypadku korzystania z EF Core migracji w celu zarządzania schematem bazy danych, poniżej konfiguruje w kolumnie Właściwość uwzględnianie wielkości liter `Name` w bazie danych, która w przeciwnym razie jest zależna od wielkości liter:</span><span class="sxs-lookup"><span data-stu-id="59105-127">When using EF Core migrations to manage your database schema, the following configures the column for the `Name` property to be case-insensitive in a database that is otherwise configured to be case-sensitive:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=OnModelCreating&highlight=6)]

## <a name="explicit-collation-in-a-query"></a><span data-ttu-id="59105-128">Jawne sortowanie w zapytaniu</span><span class="sxs-lookup"><span data-stu-id="59105-128">Explicit collation in a query</span></span>

<span data-ttu-id="59105-129">W niektórych przypadkach ta sama kolumna musi być kwerendą przy użyciu różnych sortowania według różnych zapytań.</span><span class="sxs-lookup"><span data-stu-id="59105-129">In some cases, the same column needs to be queried using different collations by different queries.</span></span> <span data-ttu-id="59105-130">Na przykład jedno zapytanie może wymagać wykonania porównania z uwzględnieniem wielkości liter w kolumnie, podczas gdy inna może wymagać wykonania porównania bez uwzględniania wielkości liter w tej samej kolumnie.</span><span class="sxs-lookup"><span data-stu-id="59105-130">For example, one query may need to perform a case-sensitive comparison on a column, while another may need to perform a case-insensitive comparison on the same column.</span></span> <span data-ttu-id="59105-131">W tym celu można jawnie określić sortowanie w ramach zapytania:</span><span class="sxs-lookup"><span data-stu-id="59105-131">This can be accomplished by explicitly specifying a collation within the query itself:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/Collations/Program.cs?name=SimpleQueryCollation)]

<span data-ttu-id="59105-132">Spowoduje to wygenerowanie `COLLATE` w zapytaniu SQL klauzuli, która stosuje sortowanie z uwzględnieniem wielkości liter niezależnie od sortowania zdefiniowanego na poziomie kolumny lub bazy danych:</span><span class="sxs-lookup"><span data-stu-id="59105-132">This generates a `COLLATE` clause in the SQL query, which applies a case-sensitive collation regardless of the collation defined at the column or database level:</span></span>

```sql
SELECT [c].[Id], [c].[Name]
FROM [Customers] AS [c]
WHERE [c].[Name] COLLATE SQL_Latin1_General_CP1_CS_AS = N'John'
```

### <a name="explicit-collations-and-indexes"></a><span data-ttu-id="59105-133">Jawne sortowanie i indeksy</span><span class="sxs-lookup"><span data-stu-id="59105-133">Explicit collations and indexes</span></span>

<span data-ttu-id="59105-134">Indeksy są jednym z najważniejszych czynników wydajności bazy danych — zapytanie, które działa wydajnie z indeksem, może zostać rozdrobne bez tego indeksu.</span><span class="sxs-lookup"><span data-stu-id="59105-134">Indexes are one of the most important factors in database performance - a query that runs efficiently with an index can grind to a halt without that index.</span></span> <span data-ttu-id="59105-135">Indeksy niejawnie dziedziczą sortowanie kolumn; oznacza to, że wszystkie zapytania w kolumnie są automatycznie uprawnione do używania indeksów zdefiniowanych w tej kolumnie — pod warunkiem, że zapytanie nie określa innego sortowania.</span><span class="sxs-lookup"><span data-stu-id="59105-135">Indexes implicitly inherit the collation of their column; this means that all queries on the column are automatically eligible to use indexes defined on that column - provided that the query doesn't specify a different collation.</span></span> <span data-ttu-id="59105-136">Określenie jawnego sortowania w zapytaniu zwykle uniemożliwi użycie przez zapytanie indeksu zdefiniowanego w tej kolumnie, ponieważ sortowania nie będą już zgodne; w związku z tym zalecane jest zachowanie ostrożności podczas korzystania z tej funkcji.</span><span class="sxs-lookup"><span data-stu-id="59105-136">Specifying an explicit collation in a query will generally prevent that query from using an index defined on that column, since the collations would no longer match; it is therefore recommended to exercise caution when using this feature.</span></span> <span data-ttu-id="59105-137">Zawsze zaleca się zdefiniowanie sortowania na poziomie kolumny (lub bazy danych), co pozwala wszystkim zapytaniom niejawnie używać tego sortowania i korzystać z dowolnego indeksu.</span><span class="sxs-lookup"><span data-stu-id="59105-137">It is always preferable to define the collation at the column (or database) level, allowing all queries to implicitly use that collation and benefit from any index.</span></span>

<span data-ttu-id="59105-138">Należy pamiętać, że niektóre bazy danych umożliwiają zdefiniowanie sortowania podczas tworzenia indeksu (np. PostgreSQL, SQLite).</span><span class="sxs-lookup"><span data-stu-id="59105-138">Note that some databases allow the collation to be defined when creating an index (e.g. PostgreSQL, Sqlite).</span></span> <span data-ttu-id="59105-139">Pozwala to na zdefiniowanie wielu indeksów w tej samej kolumnie i przyspieszenie operacji z różnymi sortowaniami (np. w przypadku uwzględniania wielkości liter i porównań bez uwzględniania wielkości liter).</span><span class="sxs-lookup"><span data-stu-id="59105-139">This allows multiple indexes to be defined on the same column, speeding up operations with different collations (e.g. both case-sensitive and case-insensitive comparisons).</span></span> <span data-ttu-id="59105-140">Aby uzyskać więcej informacji, zapoznaj się z dokumentacją dostawcy bazy danych.</span><span class="sxs-lookup"><span data-stu-id="59105-140">Consult your database provider's documentation for more details.</span></span>

> [!WARNING]
> <span data-ttu-id="59105-141">Zawsze sprawdzaj plany zapytań w zapytaniach i upewnij się, że odpowiednie indeksy są używane w kwerendach o krytycznym znaczeniu dla wydajności wykonywanych w przypadku dużych ilości danych.</span><span class="sxs-lookup"><span data-stu-id="59105-141">Always inspect the query plans of your queries, and make sure the proper indexes are being used in performance-critical queries executing over large amounts of data.</span></span> <span data-ttu-id="59105-142">Zastępowanie wielkości liter w zapytaniach za pośrednictwem `EF.Functions.Collate` (lub przez wywoływanie `string.ToLower` ) może mieć znaczący wpływ na wydajność aplikacji.</span><span class="sxs-lookup"><span data-stu-id="59105-142">Overriding case-sensitivity in a query via `EF.Functions.Collate` (or by calling `string.ToLower`) can have a very significant impact on your application's performance.</span></span>

## <a name="translation-of-built-in-net-string-operations"></a><span data-ttu-id="59105-143">Tłumaczenie wbudowanych operacji na ciągach .NET</span><span class="sxs-lookup"><span data-stu-id="59105-143">Translation of built-in .NET string operations</span></span>

<span data-ttu-id="59105-144">W przypadku platformy .NET równość w postaci ciągów jest domyślnie rozróżniana: `s1 == s2` wykonuje porównanie porządkowe, które wymaga, aby ciągi były takie same.</span><span class="sxs-lookup"><span data-stu-id="59105-144">In .NET, string equality is case-sensitive by default: `s1 == s2` performs an ordinal comparison that requires the strings to be identical.</span></span> <span data-ttu-id="59105-145">Ponieważ domyślne sortowanie baz danych jest różne i dlatego pożądane jest proste równość używania indeksów, EF Core nie podejmuje próby przetłumaczenia prostej równości na operacje z uwzględnieniem wielkości liter w bazie danych: równość języka C# jest tłumaczona bezpośrednio do poziomu równości SQL, co może być zależne od wielkości liter, w zależności od określonej używanej bazy danych i jej konfiguracji sortowania.</span><span class="sxs-lookup"><span data-stu-id="59105-145">Because the default collation of databases varies, and because it is desirable for simple equality to use indexes, EF Core makes no attempt to translate simple equality to a database case-sensitive operation: C# equality is translated directly to SQL equality, which may or may not be case-sensitive, depending on the specific database in use and its collation configuration.</span></span>

<span data-ttu-id="59105-146">Ponadto platforma .NET zapewnia przeciążenia [`string.Equals`](https://docs.microsoft.com/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) akceptujące [`StringComparison`](https://docs.microsoft.com/dotnet/api/system.stringcomparison) Wyliczenie, które umożliwia określanie uwzględniania wielkości liter i kultury dla porównania.</span><span class="sxs-lookup"><span data-stu-id="59105-146">In addition, .NET provides overloads of [`string.Equals`](https://docs.microsoft.com/dotnet/api/system.string.equals#System_String_Equals_System_String_System_StringComparison_) accepting a [`StringComparison`](https://docs.microsoft.com/dotnet/api/system.stringcomparison) enum, which allows specifying case-sensitivity and culture for the comparison.</span></span> <span data-ttu-id="59105-147">Zgodnie z projektem, EF Core zaniechania tłumaczenia tych przeciążeń na SQL i próba ich użycia spowoduje wyjątek.</span><span class="sxs-lookup"><span data-stu-id="59105-147">By design, EF Core refrains from translating these overloads to SQL, and attempting to use them will result in an exception.</span></span> <span data-ttu-id="59105-148">Dla jednego z tych EF Core nie wie, w jakim przypadku należy użyć sortowania bez uwzględniania wielkości liter lub wielkości liter.</span><span class="sxs-lookup"><span data-stu-id="59105-148">For one thing, EF Core does know not which case-sensitive or case-insensitive collation should be used.</span></span> <span data-ttu-id="59105-149">Co ważniejsze, zastosowanie sortowania w większości przypadków uniemożliwi użycie indeksu, znacząco wpływając na wydajność dla bardzo podstawowej i powszechnie używanej konstrukcji platformy .NET.</span><span class="sxs-lookup"><span data-stu-id="59105-149">More importantly, applying a collation would in most cases prevent index usage, significantly impacting performance for a very basic and commonly-used .NET construct.</span></span> <span data-ttu-id="59105-150">Aby wymusić użycie porównania z rozróżnianiem wielkości liter lub bez uwzględniania wielkości liter, określ sortowanie jawnie za pomocą podanego `EF.Functions.Collate` [powyżej](#explicit-collations-and-indexes).</span><span class="sxs-lookup"><span data-stu-id="59105-150">To force a query to use case-sensitive or case-insensitive comparison, specify a collation explicitly via `EF.Functions.Collate` as [detailed above](#explicit-collations-and-indexes).</span></span>

## <a name="database-specific-information"></a><span data-ttu-id="59105-151">Informacje specyficzne dla bazy danych</span><span class="sxs-lookup"><span data-stu-id="59105-151">Database-specific information</span></span>

* <span data-ttu-id="59105-152">[SQL Server dokumentacja dotycząca sortowania](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support).</span><span class="sxs-lookup"><span data-stu-id="59105-152">[SQL Server documentation on collations](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support).</span></span>
* <span data-ttu-id="59105-153">[Dokumentacja Microsoft. Data. sqlite dotycząca sortowania](https://docs.microsoft.com/dotnet/standard/data/sqlite/collation).</span><span class="sxs-lookup"><span data-stu-id="59105-153">[Microsoft.Data.Sqlite documentation on collations](https://docs.microsoft.com/dotnet/standard/data/sqlite/collation).</span></span>
* <span data-ttu-id="59105-154">[PostgreSQL dokumentację dotyczącą sortowania](https://www.postgresql.org/docs/current/collation.html).</span><span class="sxs-lookup"><span data-stu-id="59105-154">[PostgreSQL documentation on collations](https://www.postgresql.org/docs/current/collation.html).</span></span>
* <span data-ttu-id="59105-155">[Dokumentacja bazy danych MySQL dotycząca sortowania](https://dev.mysql.com/doc/refman/en/charset-general.html).</span><span class="sxs-lookup"><span data-stu-id="59105-155">[MySQL documentation on collations](https://dev.mysql.com/doc/refman/en/charset-general.html).</span></span>
