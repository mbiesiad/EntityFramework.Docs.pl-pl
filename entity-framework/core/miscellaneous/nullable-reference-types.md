---
title: Praca z typami odwołań do wartości null — EF Core
author: roji
ms.date: 9/9/2019
ms.assetid: bde4e0ee-fba3-4813-a849-27049323d301
uid: core/miscellaneous/nullable-reference-types
ms.openlocfilehash: 1aa49f1ed518dfe4c13976cef8e868f58d12d5a3
ms.sourcegitcommit: ec196918691f50cd0b21693515b0549f06d9f39c
ms.translationtype: MT
ms.contentlocale: pl-PL
ms.lasthandoff: 09/23/2019
ms.locfileid: "71204418"
---
# <a name="working-with-nullable-reference-types"></a><span data-ttu-id="7fe80-102">Praca z typami odwołań dopuszczających wartości null</span><span class="sxs-lookup"><span data-stu-id="7fe80-102">Working with Nullable Reference Types</span></span>

<span data-ttu-id="7fe80-103">C#8 wprowadzono nową funkcję o nazwie [dopuszczającej wartość null](/dotnet/csharp/tutorials/nullable-reference-types), co pozwala na dodawanie adnotacji do typów odwołań wskazujących, czy są one prawidłowe dla nich, aby zawierały wartość null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-103">C# 8 introduced a new feature called [nullable reference types](/dotnet/csharp/tutorials/nullable-reference-types), allowing reference types to be annotated, indicating whether it is valid for them to contain null or not.</span></span> <span data-ttu-id="7fe80-104">Jeśli dopiero zaczynasz tę funkcję, zalecamy zapoznanie się z nią, czytając C# dokumenty.</span><span class="sxs-lookup"><span data-stu-id="7fe80-104">If you are new to this feature, it is recommended that make yourself familiar with it by reading the C# docs.</span></span>

<span data-ttu-id="7fe80-105">Ta strona EF Core zawiera wprowadzenie do pomocy technicznej dotyczącej typów referencyjnych dopuszczających wartość null i opisuje najlepsze rozwiązania dotyczące pracy z nimi.</span><span class="sxs-lookup"><span data-stu-id="7fe80-105">This page introduces EF Core's support fo nullable reference types, and describes best practices for working with them.</span></span>

## <a name="required-and-optional-properties"></a><span data-ttu-id="7fe80-106">Właściwości wymagane i opcjonalne</span><span class="sxs-lookup"><span data-stu-id="7fe80-106">Required and optional properties</span></span>

<span data-ttu-id="7fe80-107">Główna dokumentacja dotycząca wymaganych i opcjonalnych właściwości oraz ich interakcji z typami odwołań dopuszczających wartość null jest stroną [Właściwości wymagane i opcjonalne](xref:core/modeling/required-optional) .</span><span class="sxs-lookup"><span data-stu-id="7fe80-107">The main documentation on required and optional properties and their interaction with nullable reference types is the [Required and Optional Properties](xref:core/modeling/required-optional) page.</span></span> <span data-ttu-id="7fe80-108">Zalecamy rozpoczęcie od początku odczytywania tej strony.</span><span class="sxs-lookup"><span data-stu-id="7fe80-108">It is recommended you start out by reading that page first.</span></span>

> [!NOTE]
> <span data-ttu-id="7fe80-109">Należy zachować ostrożność podczas włączania typów referencyjnych dopuszczających wartość null w istniejącym projekcie: właściwości typu referencyjnego, które zostały wcześniej skonfigurowane jako opcjonalne, zostaną teraz skonfigurowane zgodnie z wymaganiami, chyba że zostaną jawnie dodane do wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-109">Exercise caution when enabling nullable reference types on an existing project: reference type properties which were previously configured as optional will now be configured as required, unless they are explicitly annotated to be nullable.</span></span> <span data-ttu-id="7fe80-110">W przypadku zarządzania schematem relacyjnej bazy danych może to spowodować wygenerowanie migracji, co pozwala zmienić wartość null kolumny bazy danych.</span><span class="sxs-lookup"><span data-stu-id="7fe80-110">When managing a relational database schema, this may cause migrations to be generated which alter the database column's nullability.</span></span>

## <a name="dbcontext-and-dbset"></a><span data-ttu-id="7fe80-111">DbContext i Nieogólnymi</span><span class="sxs-lookup"><span data-stu-id="7fe80-111">DbContext and DbSet</span></span>

<span data-ttu-id="7fe80-112">Gdy włączone są typy odwołań dopuszczających wartość C# null, kompilator emituje ostrzeżenia dla każdej niezainicjowanej właściwości, która nie dopuszcza wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-112">When nullable reference types are enabled, the C# compiler emits warnings for any uninitialized non-nullable property, as these would contain null.</span></span> <span data-ttu-id="7fe80-113">W związku z tym powszechną metodą definiowania niedopuszczających wartości null `DbSet` w kontekście będzie teraz wygenerowanie ostrzeżenia.</span><span class="sxs-lookup"><span data-stu-id="7fe80-113">As a result, the common practice of defining a non-nullable `DbSet` on a context will now generate a warning.</span></span> <span data-ttu-id="7fe80-114">Jednak EF Core zawsze inicjuje wszystkie `DbSet` właściwości dla typów pochodnych DbContext, więc są one gwarantowane, że nigdy nie będzie mieć wartości null, nawet jeśli kompilator nie będzie mógł tego wiedzieć.</span><span class="sxs-lookup"><span data-stu-id="7fe80-114">However, EF Core always initializes all `DbSet` properties on DbContext-derived types, so they are guaranteed to never be null, even if the compiler is unaware of this.</span></span> <span data-ttu-id="7fe80-115">W związku z tym zaleca się zachowanie `DbSet` właściwości niedopuszczających wartości null — pozwala to na dostęp do nich bez sprawdzania wartości null — i wyciszenie ostrzeżeń kompilatora przez jawne ustawienie wartości null przy użyciu operatora łagodniejszej o wartości null (!):</span><span class="sxs-lookup"><span data-stu-id="7fe80-115">Therefore, it is recommended to keep your `DbSet` properties non-nullable - allowing you to access them without null checks - and to silence the compiler warnings by explicitly setting them to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/NullableReferenceTypesContext.cs?name=Context&highlight=3-4)]

## <a name="non-nullable-properties-and-initialization"></a><span data-ttu-id="7fe80-116">Właściwości i inicjalizacje bez dopuszczania wartości null</span><span class="sxs-lookup"><span data-stu-id="7fe80-116">Non-nullable properties and initialization</span></span>

<span data-ttu-id="7fe80-117">Ostrzeżenia kompilatora dla niezainicjowanych typów referencyjnych, które nie dopuszczają wartości null, są również problemem dla zwykłych właściwości w typach jednostek.</span><span class="sxs-lookup"><span data-stu-id="7fe80-117">Compiler warnings for uninitialized non-nullable reference types are also a problem for regular properties on your entity types.</span></span> <span data-ttu-id="7fe80-118">W naszym przykładzie unikamy tych ostrzeżeń przy użyciu [powiązania konstruktora](xref:core/modeling/constructors), a funkcja, która doskonale sprawdza się w przypadku właściwości, które nie dopuszcza wartości null, gwarantując, że są one zawsze inicjowane.</span><span class="sxs-lookup"><span data-stu-id="7fe80-118">In our example above, we avoided these warnings by using [constructor binding](xref:core/modeling/constructors), a feature which works perfectly with non-nullable properties, ensuring they are always initialized.</span></span> <span data-ttu-id="7fe80-119">Jednak w niektórych scenariuszach powiązanie konstruktora nie jest opcją: nie można w ten sposób zainicjować właściwości nawigacji, na przykład.</span><span class="sxs-lookup"><span data-stu-id="7fe80-119">However, in some scenarios constructor binding isn't an option: navigation properties, for example, cannot be initialized in this way.</span></span>

<span data-ttu-id="7fe80-120">Wymagane właściwości nawigacji stanowią dodatkowe trudności: Chociaż dla danego podmiotu zależnego będzie zawsze istniała zależność, może ona zostać załadowana przez określone zapytanie lub nie można jej załadować w zależności od potrzeb w tym punkcie w programie ([Zobacz różne wzorce dla Ładowanie danych](xref:core/querying/related-data)).</span><span class="sxs-lookup"><span data-stu-id="7fe80-120">Required navigation properties present an additional difficulty: although a dependent will always exist for a given principal, it may or may not be loaded by a particular query, depending on the needs at that point in the program ([see the different patterns for loading data](xref:core/querying/related-data)).</span></span> <span data-ttu-id="7fe80-121">W tym samym czasie nie należy wprowadzać tych właściwości do wartości null, ponieważ spowodowałoby to wymuszenie dostępu do nich do sprawdzenia pod kątem wartości null, nawet jeśli są one wymagane.</span><span class="sxs-lookup"><span data-stu-id="7fe80-121">At the same time, it is undesirable to make these properties nullable, since that would force all access to them to check for null, even if they are required.</span></span>

<span data-ttu-id="7fe80-122">Jednym ze sposobów postępowania z tymi scenariuszami jest posiadanie właściwości niedopuszczającej wartości null przy użyciu [pola zapasowego](xref:core/modeling/backing-field)dopuszczającego wartość null:</span><span class="sxs-lookup"><span data-stu-id="7fe80-122">One way to deal with these scenarios, is to have a non-nullable property with a nullable [backing field](xref:core/modeling/backing-field):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=12-17)]

<span data-ttu-id="7fe80-123">Ponieważ właściwość nawigacji nie dopuszcza wartości null, jest konfigurowana wymagana Nawigacja; i tak długo, jak nawigacja zostanie prawidłowo załadowana, zależna będzie dostępna za pośrednictwem właściwości.</span><span class="sxs-lookup"><span data-stu-id="7fe80-123">Since the navigation property is non-nullable, a required navigation is configured; and as long as the navigation is properly loaded, the dependent will be accessible via the property.</span></span> <span data-ttu-id="7fe80-124">Jeśli jednak właściwość jest dostępna bez wcześniejszego poprawnego załadowania powiązanej jednostki, zgłaszany jest InvalidOperationException, ponieważ kontrakt interfejsu API został niepoprawnie użyty.</span><span class="sxs-lookup"><span data-stu-id="7fe80-124">If, however, the property is accessed without first properly loading the related entity, an InvalidOperationException is thrown, since the API contract has been used incorrectly.</span></span>

<span data-ttu-id="7fe80-125">Jako alternatywę Terser można po prostu zainicjować właściwość null przy użyciu operatora null-łagodniejszej (!):</span><span class="sxs-lookup"><span data-stu-id="7fe80-125">As a terser alternative, it is possible to simply initialize the property to null with the help of the null-forgiving operator (!):</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Order.cs?range=19)]

<span data-ttu-id="7fe80-126">Rzeczywista wartość null nigdy nie będzie obserwowana, chyba że w wyniku błędu programowania, np. do uzyskania dostępu do właściwości nawigacji bez prawidłowo załadowania powiązanej jednostki.</span><span class="sxs-lookup"><span data-stu-id="7fe80-126">An actual null value will never be observed except as a result of a programming bug, e.g. accessing the navigation property without properly loading the related entity beforehand.</span></span>

> [!NOTE]
> <span data-ttu-id="7fe80-127">Nawigacja kolekcji, która zawiera odwołania do wielu pokrewnych jednostek, nie powinna być zawsze dopuszczana do wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-127">Collection navigations, which contain references to multiple related entities, should always be non-nullable.</span></span> <span data-ttu-id="7fe80-128">Pusta kolekcja oznacza, że nie istnieją żadne powiązane jednostki, ale sama lista nie powinna mieć wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-128">An empty collection means that no related entities exist, but the list itself should never be null.</span></span>

## <a name="navigating-and-including-nullable-relationships"></a><span data-ttu-id="7fe80-129">Nawigowanie i uwzględnianie relacji dopuszczających wartości null</span><span class="sxs-lookup"><span data-stu-id="7fe80-129">Navigating and including nullable relationships</span></span>

<span data-ttu-id="7fe80-130">Podczas pracy z opcjonalnymi relacjami można napotkać ostrzeżenia kompilatora, w których rzeczywisty wyjątek odwołania o wartości null byłby możliwy.</span><span class="sxs-lookup"><span data-stu-id="7fe80-130">When dealing with optional relationships, it's possible to encounter compiler warnings where an actual null reference exception would be impossible.</span></span> <span data-ttu-id="7fe80-131">Podczas tłumaczenia i wykonywania zapytań LINQ EF Core gwarantuje, że jeśli opcjonalna powiązana jednostka nie istnieje, dowolna Nawigacja do niej zostanie po prostu zignorowana, a nie przerzucana.</span><span class="sxs-lookup"><span data-stu-id="7fe80-131">When translating and executing your LINQ queries, EF Core guarantees that if an optional related entity does not exist, any navigation to it will simply be ignored, rather than throwing.</span></span> <span data-ttu-id="7fe80-132">Jednak kompilator nie rozpoznaje tej EF Core gwarancji i generuje ostrzeżenia tak, jakby kwerenda LINQ była wykonywana w pamięci, z LINQ to Objects.</span><span class="sxs-lookup"><span data-stu-id="7fe80-132">However, the compiler is unaware of this EF Core guarantee, and produces warnings as if the LINQ query were executed in memory, with LINQ to Objects.</span></span> <span data-ttu-id="7fe80-133">W związku z tym należy użyć operatora null-łagodniejszej (!) do informowania kompilatora, że rzeczywista wartość null nie jest możliwa:</span><span class="sxs-lookup"><span data-stu-id="7fe80-133">As a result, it is necessary to use the null-forgiving operator (!) to inform the compiler that an actual null value isn't possible:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=46)]

<span data-ttu-id="7fe80-134">Podobny problem występuje w przypadku uwzględnienia wielu poziomów relacji między opcjonalnymi nawigacjami:</span><span class="sxs-lookup"><span data-stu-id="7fe80-134">A similar issue occurs when including multiple levels of relationships across optional navigations:</span></span>

[!code-csharp[Main](../../../samples/core/Miscellaneous/NullableReferenceTypes/Program.cs?range=36-39&highlight=2)]

<span data-ttu-id="7fe80-135">Jeśli znajdziesz się w tej partii, a typy jednostek, których dotyczy, są głównie (lub wyłącznie) używane w zapytaniach EF Core, rozważ wprowadzenie właściwości nawigacji, które nie dopuszczają wartości null, i skonfigurowanie ich jako opcjonalnego za pośrednictwem interfejsu API Fluent lub adnotacji danych.</span><span class="sxs-lookup"><span data-stu-id="7fe80-135">If you find yourself doing this a lot, and the entity types in question are predominantly (or exclusively) used in EF Core queries, consider making the navigation properties non-nullable, and to configure them as optional via the Fluent API or Data Annotations.</span></span> <span data-ttu-id="7fe80-136">Spowoduje to usunięcie wszystkich ostrzeżeń kompilatora z zachowaniem opcjonalnej relacji; Jeśli jednak obiekty są przenoszone poza EF Core, można zaobserwować wartości null, chociaż właściwości są adnotacją jako niedopuszczające wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-136">This will remove all compiler warnings while keeping the relationship optional; however, if your entities are traversed outside of EF Core, you may observe null values although the properties are annotated as non-nullable.</span></span>

## <a name="scaffolding"></a><span data-ttu-id="7fe80-137">Tworzenie szkieletów</span><span class="sxs-lookup"><span data-stu-id="7fe80-137">Scaffolding</span></span>

<span data-ttu-id="7fe80-138">[Funkcja C# typu referencyjnego 8 dopuszczających wartość null](/dotnet/csharp/tutorials/nullable-reference-types) nie jest obecnie obsługiwana w przypadku odtwarzania: EF Core zawsze generuje C# kod, który zakłada, że funkcja jest wyłączona.</span><span class="sxs-lookup"><span data-stu-id="7fe80-138">[The C# 8 nullable reference type feature](/dotnet/csharp/tutorials/nullable-reference-types) is currently unsupported in reverse engineering: EF Core always generates C# code that assumes the feature is off.</span></span> <span data-ttu-id="7fe80-139">Na przykład kolumny tekstu dopuszczające wartość null będą szkieletem jako właściwość typu `string` , a nie `string?`z interfejsem API Fluent lub adnotacjami danych używanymi do konfigurowania, czy właściwość jest wymagana.</span><span class="sxs-lookup"><span data-stu-id="7fe80-139">For example, nullable text columns will be scaffolded as a property with type `string` , not `string?`, with either the Fluent API or Data Annotations used to configure whether a property is required or not.</span></span> <span data-ttu-id="7fe80-140">Można edytować kod szkieletowy i zastąpić je adnotacjami o C# wartości null.</span><span class="sxs-lookup"><span data-stu-id="7fe80-140">You can edit the scaffolded code and replace these with C# nullability annotations.</span></span> <span data-ttu-id="7fe80-141">Obsługa tworzenia szkieletów dla typów odwołań do wartości null jest śledzona przez [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520)problemu.</span><span class="sxs-lookup"><span data-stu-id="7fe80-141">Scaffolding support for nullable reference types is tracked by issue [#15520](https://github.com/aspnet/EntityFrameworkCore/issues/15520).</span></span>
